define(["require","app/helpers/debugger","app/models/user","app/helpers/time"],function(e,t,n,r){var i={};return i.load=function(e,n){this.user=e,this.site=n;var r=this;return t.log("Loading the lightbox",0),e.logged_in===!1?(t.log("User is not logged in, don't load it"),t.log("Finished"),!1):(t.log("Prepending lightbox to <body>"),$("<div/>",{id:"sr_lightbox",html:"<div id='sr_lightbox_inner'></div>"}).prependTo("body"),$("#sr_lightbox_inner").length!==0?t.log("Lightbox added: SUCCESS"):t.log("Lightbox added: FAILURE"),this.setup_listeners(),t.log("Finished"))},i.setup_listeners=function(){var e=this;t.log("Setup jQuery listener for close lightbox link click"),$("a#sr_close_lightbox").live("click",function(){return e.close()})},i.show=function(e,n){var r=this;return t.log("Fade in lightbox",0),t.log("Fading"),$("#sr_lightbox").fadeIn("fast",function(){return t.log("Finished"),r.show_activity(e,n)})},i.close=function(){var e=this;return t.log("Closing lightbox",0),t.log("Fading out"),$("#sr_lightbox").fadeOut(function(){return $("#sr_lightbox #sr_lightbox_inner").html(""),t.log("Html lightbox inner set to blank"),t.log("Finished")})},i.show_activity=function(e,n){var i=this;$("#sr_lightbox_inner").html("			<h3>Recent activity</h3>			<a id='sr_close_lightbox'>Close</a>			<div id='sr_loading'><img src='"+this.site.plugin_url+"/images/ajax-loader.gif' alt='Loading...'></div>			<ul id='sr_activity_tabs'>				<li id='sr_lightbox_everyone' class='sr_active_tab'><a>Everyone</a></li>				<li id='sr_lightbox_me'><a>Just you</a></li>			</ul>			<div id='sr_reads_list'><ul></ul></div>		");var s,o,u,a,f,l;t.log("Putting reads into the lightbox",0),$("#sr_loading").hide(),t.log("Found "+n.activity.reads.length+" reads"),s="",l=n.activity.reads;for(a=0,f=l.length;a<f;a++){o=l[a],o.from.id===n.user.id?u="sr_me_story":u="sr_friend_story";if(!o.data||!o.data.article)continue;s+="<li id='sr_read_"+o.id+"' class='"+u+"'>						<a class='name' href='//facebook.com/"+o.from.id+"' target='blank'>							<img class='story-img' src='https://graph.facebook.com/"+o.from.id+"/picture' width='50' height='50' alt='"+o.from.name+"' />						</a>						<div class='story-inner'>							<div class='story-title'>								<a class='name' href='//facebook.com/profile.php?id="+o.from.id+"' target='blank'>									"+o.from.name+"								</a> read 								<a class='article' href='"+o.data.article.url+"' target='blank'>"+o.data.article.title+"</a>							</div>							<div class='story-meta'>								"+r.relative(o.publish_time)+"								<span>&middot; <a class='sr_story_delete'>Delete</a></span>							</div>						</div>						<div class='sr_clear'></div>					</li>"}return $("#sr_reads_list ul").html(s),t.log("Html put: SUCCESS"),t.log("Showing stuff"),$("#sr_activity_tabs").show(),$("#sr_reads_list").show(),t.log("Adding jQuery listener for filter tabs"),$("#sr_activity_tabs a").on("click",function(){return t.log("Lightbox activity tab click detected",0),$("#sr_activity_tabs li").removeClass("sr_active_tab"),t.log("Removed class from existing tab"),$(this).closest("li").addClass("sr_active_tab"),t.log("Added class to the clicked tab"),$(this).closest("li").attr("id")==="sr_lightbox_everyone"?(t.log("Everyone tab detected, show all stories"),$("#sr_reads_list ul li").show()):$(this).closest("li").attr("id")==="sr_lightbox_me"&&(t.log("Me tab detected, just show my stories"),$("#sr_reads_list ul li.sr_friend_story").hide()),t.log("Finished")}),t.log("Adding jQuery listener for deleting reads"),$(".sr_story_delete").on("click",function(){var e;return e=$(this).closest("li").attr("id").replace("sr_read_",""),i.model.fb_delete_read(e,function(e){return $("#sr_read_{read_id}").fadeOut(function(){return $("#sr_read_{read_id}").remove()})})}),t.log("Finished")},i});