/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

define("jquery",["jquery_cdn"],function(){return jQuery.noConflict(!0)}),define("app/helpers/url-param",[],function(){var e={};return e.exists=function(e){var t,n,r,i,s,o;n=window.location.search.substring(1),s=0,o="?";if(n.length>0){i=n.split("&"),r=0;while(r<i.length){t=i[r].split("=");if(t[0]===e)return!0;r++}}return!1},e}),define("app/helpers/debugger",["app/helpers/url-param"],function(e){var t={};return t.start=function(){return e.exists("sr_debug")?(this.debug_mode=!0,console.log("***********************************************\n* Welcome to the Social Reader debug console! *\n***********************************************")):this.debug_mode=!1},t.log=function(e,t){t==null&&(t=1);if(this.debug_mode===!0){if(t===1)return console.log("  * "+e);if(t===2)return console.log("    - "+e);if(t===0)return console.log("\n"+e+":")}},t.start(),t}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.3";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t){return x.isEmpty(t)?[]:x.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0==t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=M(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),x.isFunction=function(e){return"function"==typeof e},x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=""+ ++P;return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){n=x.defaults({},n,x.templateSettings);var r=RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=u+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,x);var a=function(e){return o.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),define("app/tests/main",["require","app/helpers/debugger","app/helpers/url-param","underscore"],function(e,t,n,r){var i={};return i.modules=["helpers/cookie","helpers/single-format"],i.are_on=function(){return t.log("Seeing if we're running tests"),n.exists("sr_tests")?(t.log("Testing is ON"),!0):(t.log("Testing is OFF"),!1)},i.start=function(){var n=this;t.log("Finished loading qunit.js"),r.each(n.modules,function(n){e(["app/tests/"+n],function(e){t.log("Loaded app/tests/"+n+", now run it"),e.run()})})},i}),define("app/helpers/cookie",["require"],function(){var e={};return e.set=function(e,t,n){var r,i;return i=new Date,i.setDate(i.getDate()+n),r=escape(t)+(n==null?"":"; expires="+i.toUTCString()),document.cookie=e+"="+r},e.get=function(e){var t,n,r,i;t=document.cookie.split(";"),n=0;while(n<t.length){r=t[n].substr(0,t[n].indexOf("=")),i=t[n].substr(t[n].indexOf("=")+1),r=r.replace(/^\s+|\s+jquery/g,"");if(r===e)return unescape(i);n++}return!1},e.exists=function(e){return this.get(e)?!0:!1},e.remove=function(e){return document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e}),define("app/models/cache",["require","app/helpers/debugger","app/helpers/cookie","jquery","json2"],function(e){var t=e("app/helpers/debugger"),n=e("app/helpers/cookie"),r=e("jquery"),i=e("json2"),s={};return s.save=function(e,n,i,s){t.log("Saving "+n+" to the cache");var o=this;return r.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"save_cache",fb_id:e,field:n,data:JSON.stringify(i)}).done(function(e){e!="0"?(t.log(n+" saved successfully"),t.log("Finished"),s!==undefined&&s()):(t.log("Data failed to save:"),t.log("Finished"),s!==undefined&&s())})},s.save_user=function(e,i){return r.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"save_user",user:JSON.stringify(e)},function(r){try{var s=JSON.parse(r);s&&(n.set("sr_user_id",e.id,null),n.set("sr_user_cached","true",null),t.log("user_cache saved successfully"),t.log("Finished")),window._sr.user=s,i()}catch(o){t.log("Failed to parse JSON"),console.log(r)}})},s.get=function(e,n,i){var s=this;return t.log("Getting the "+n),r.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"get_cache",fb_id:e,field:n},function(e){t.log("Ajax request complete"),t.log("Converting data to json object");try{var n=JSON.parse(e);t.log("JSON parsed: SUCCESS"),t.log("Finished"),i!==null&&i(n)}catch(r){t.log("JSON parsed: FAILURE"),t.log("Finished"),i!==null&&i()}})},s.clear_all=function(){delete window._sr.user,delete window._sr.activity,delete window._sr.friends,n.remove("sr_user_id"),n.remove("sr_user_cached"),n.remove("sr_activity_cached"),n.remove("sr_friends_cached")},s.refresh=function(){t.log("Refreshing cache by deleting cookies",0),n.remove("sr_activity_cache"),n.remove("sr_friends_cache")},s}),define("app/models/fb",["require","jquery","app/helpers/debugger","app/helpers/cookie","app/models/cache","underscore","json2"],function(e){var t=e("jquery"),n=e("app/helpers/debugger"),r=e("app/helpers/cookie"),i=e("app/models/cache"),s=e("underscore"),o=e("json2"),u={user:{},friends:[],activity:{}};return u.init=function(e,r){var i=this,s=e.fb_app_id,o=e.fb_channel_url,u=e.fb_sdk_disable;if(!s)return n.log("Facebook app id not specified, STOP"),!1;n.log("Initiliazing Facebook",0);if(u!==!0)return t("body").prepend('<div id="fb-root"></div>'),n.log("Prepended div fb-root to body"),window.fbAsyncInit=function(){return n.log("Loading the SDK asynchronously with app id: "+s+", channel url: "+o),FB.init({appId:s,channelUrl:o,status:!0,cookie:!0,xfbml:!0}),n.log("SDK loaded"),n.log("Finished"),r()},function(e,t){var n,r,i;r=void 0,n="facebook-jssdk",i=e.getElementsByTagName("script")[0];if(e.getElementById(n))return;return r=e.createElement("script"),r.id=n,r.async=!0,r.src="//connect.facebook.net/en_US/all"+(t?"/debug":"")+".js",i.parentNode.insertBefore(r,i)}(window.document,!1);n.log("SDK loading disabled, wait for it to exist"),this.sdk_check_count=0,this.wait_for_fb(function(){n.log("SDK loaded"),r()})},u.wait_for_fb=function(e){this.sdk_check_count++;if(this.sdk_check_count>10){n.log("Facebook SDK loading: FAILURE");return}var r=this;window.FB?(n.log(r.sdk_check_count+": window.FB exists: SUCCESS"),t("#fb-root").length===1?(n.log('<div id="fb-root"></div> exists: SUCCESS'),e()):(n.log(r.sdk_check_count+': <div id="fb-root"></div> does not exist, try again in 100ms'),setTimeout(function(){r.wait_for_fb()},100))):(n.log(r.sdk_check_count+": window.FB does not exist, try again in 100ms"),setTimeout(function(){r.wait_for_fb()},100))},u.is_logged_in=function(e){var t=this;return n.log("See if user is logged in to Facebook and the app",0),n.log("Query Facebook"),FB.getLoginStatus(function(r){return n.log("Response from Facebook received"),r.status==="connected"?(n.log("User is logged in"),t.user.logged_in=!0,n.log("Finished"),e(!0)):(n.log("User is not logged in"),t.user.logged_in=!1,n.log("Finished"),e(!1))})},u.get_user=function(e){var t=this;return n.log("Not in cache, querying Facebook"),FB.api("/me",function(t){return n.log("Response received, setting values"),t.picture="//graph.facebook.com/"+t.id+"/picture",n.log("Finished"),e(t)})},u.login=function(e){var t=this;return n.log("Logging in the user to Facebook",0),FB.login(function(t){n.log("Response received from Facebook");if(t.status!=="connected")return n.log("User cancelled login or did not fully authorize.");n.log("Logged in successfully"),e()},{scope:"publish_actions"})},u.logout=function(e){var t=this;return n.log("Logging the user out of Facebook",0),FB.logout(function(t){n.log("Logout successful"),n.log("Removing cached coookie NEED TO DO THIS"),n.log("Reloading the page"),e()})},u.add_read=function(){var e=this;return n.log("Adding user read",0),FB.api("/me/news.reads?article="+document.URL,"post",function(t){n.log("Response received from Facebook"),t.id?(n.log("Read "+t.id+" posted to Facebook: SUCCESS"),e.refresh_my_activity()):n.log("Read posted to Facebook: FAILURE - "+t.error.message),n.log("Finished")})},u.refresh_my_activity=function(){return n.log("Refreshing my activity from Facebook",0),FB.api("me/news.reads?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from",function(e){window._sr.activity[0]=e,i.save(window._sr.user.id,"activity_cache",window._sr.activity[0])})},u.delete_read=function(e,t){var r=this;return n.log("Deleting user read",0),FB.api("/"+e,"delete",function(r){return n.log("Response received from Facebook"),r===!0?(n.log("Read deleted from Facebook: SUCCESS"),s.each(window._sr.activity[0].data,function(t,n){t.id==e&&(delete window._sr.activity[0].data[n],i.save(window._sr.user.id,"activity_cache",window._sr.activity[0]))})):(n.log("Read deleted from Facebook: FAILURE"),n.log("Error message from Facebook: "+r.error.message)),t()})},u.get_friend_users=function(e){var t=this;return FB.api("/me/friends?fields=id,name,installed",function(t){n.log("Response received, finding friend users");var r=[];s.each(t.data,function(e){e.installed===!0&&(delete e.installed,r.push(e))}),n.log(r.length+" friends found"),n.log("Finished"),e(r),i.save(window._sr.user.id,"friends_cache",r)})},u.get_activity=function(e){_this=this;var t=[];return t.push({method:"GET",user_id:window._sr.user.id,relative_url:"me/news.reads?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from"}),s.each(window._sr.friends,function(e){t.push({method:"GET",user_id:e.id,relative_url:e.id+"/news.reads?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from"})}),n.log("Starting batch requests for the "+window._sr.friends.length+" friends using this app"),FB.api("/","POST",{batch:t},function(r){n.log("Response received from Facebook");var o=[];s.each(r,function(e,n){if(!e||!e.body)return;var r=JSON.parse(e.body);o.push(r),i.save(t[n].user_id,"activity_cache",r)}),e(o)})},u.put_all_reads_in_one_array=function(e){var t=[];s.each(window._sr.activity,function(e){s.each(e.data,function(e){t.push(e)})}),n.log("Sorting the reads by publish_time descending");var r=t.sort(function(e,t){return e=new Date(e.publish_time),t=new Date(t.publish_time),e>t?-1:e<t?1:0});return n.log("Finished"),r},u}),define("app/models/user",["require","app/models/fb","app/helpers/cookie","app/helpers/debugger","app/models/cache","jquery"],function(e){var t=e("app/models/fb"),n=e("app/helpers/cookie"),r=e("app/helpers/debugger"),i=e("app/models/cache"),s=e("jquery"),o={};return o.init=function(e,n){var r=window._sr,s=this;t.init(r.site,function(){t.is_logged_in(function(t){t===!0?s.get_user(function(){s.queue_read(),e(),s.get_friends(function(){s.get_activity(function(){n()})})}):(i.clear_all(),e())})})},o.get_user=function(e){var n=this;r.log("Getting user",0);if(window._sr&&window._sr.user)return r.log("Already in cache, get from the window._sr.user variable"),r.log("Finished"),e();t.get_user(function(t){i.save_user(t,function(){e()})})},o.get_friends=function(e){r.log("Getting friends",0);if(window._sr&&window._sr.friends!==undefined)return r.log("Already in cache, get from the window._sr.friends variable"),r.log("Finished"),e();t.get_friend_users(function(t){window._sr.friends=t,n.set("sr_friends_cached","true",null),e()})},o.get_activity=function(e){r.log("Getting you and your and friends activity",0);if(window._sr&&window._sr.activity!==undefined)return r.log("Already in cache, get from the window._sr.activity variable"),r.log("Finished"),e();t.get_activity(function(t){window._sr.activity=t,n.set("sr_activity_cached","true",null),e()})},o.queue_read=function(e){return r.log("Queuing auto-read to Facebook",0),window._sr.user.is_auto_sharing===!0&&window._sr.page.is_readable===!0?(r.log("Auto-sharing on, page is readable, queue the read"),setTimeout(function(){t.add_read()},1e4),r.log("Finished"),!0):(r.log("Either auto-sharing is off or this page is not readable"),r.log("Finished"),!1)},o.set_auto_sharing=function(e){var t=this;r.log("Setting auto sharing",0),r.log("Changing auto sharing to "+e),window._sr.user.is_auto_sharing=e;var n=window._sr.user;i.save(n.id,"user_cache",n)},o.login=function(){t.login(function(){window.location.reload()})},o.logout=function(){t.logout(function(){i.clear_all(),window.location.reload()})},o}),define("app/models/analytics-listeners",[],function(){var e={};return e.sidebar_logged_in=[{selector:"#sr_sidebar_activity a",actions:["click","mouseenter"],label:"Activity"},{selector:".sr_sidebar_toggle",actions:["click","mouseenter"],label:"Toggle auto-sharing"},{selector:"a#sr_sidebar_img",actions:["click","mouseenter"],label:"Profile picture"},{selector:"#sr_sidebar_name",actions:["click","mouseenter"],label:"Profile name"},{selector:"#sr_sidebar_logout a",actions:["click","mouseenter"],label:"Logout"}],e.sidebar_logged_out=[{selector:"a#sr_sidebar_login",actions:["click","mouseenter"],label:"Login button"}],e.frs_single=[{selector:".sr_read_names a",actions:["click","mouseenter"],label:"Name"},{selector:".sr_read_thumbs a",actions:["click","mouseenter"],label:"Thumb"}],e.lightbox=[{selector:"a#sr_close_lightbox",actions:["click","mouseenter"],label:"Close"},{selector:"#sr_lightbox_everyone a",actions:["click","mouseenter"],label:"Show everyone tab"},{selector:"#sr_lightbox_me a",actions:["click","mouseenter"],label:"Show me tab"},{selector:"#sr_lightbox_inner li a img.story-img",actions:["click","mouseenter"],label:"Story profile pic"},{selector:"#sr_lightbox_inner li .story-title a.name",actions:["click","mouseenter"],label:"Story user name"},{selector:"#sr_lightbox_inner li .story-title a.article",actions:["click","mouseenter"],label:"Story article title"},{selector:"#sr_lightbox_inner li a.sr_story_delete",actions:["click","mouseenter"],label:"Story delete"}],e}),define("app/models/analytics",["require","app/helpers/debugger","underscore","app/models/analytics-listeners","jquery"],function(e){var t=e("app/helpers/debugger"),n=e("underscore"),r=e("app/models/analytics-listeners"),i=e("jquery"),s={initialized:!1,queue:[]};return s.init=function(){var r=this,i=window._sr.user,s=window._sr.site;3,t.log("Starting analytics",0);if(s.analytics_disabled===!0)return t.log("Analytics has been disabled on this site: STOP"),!1;t.log("Analytics is enabled for this site"),window._gaq=window._gaq||[],window._gaq.push(["sr._setAccount","UA-37231887-1"]),t.log("Setting custom variables"),window._gaq.push(["sr.setCustomVar",1,"logged_in",i.logged_in,2]),window._gaq.push(["sr.setCustomVar",2,"plugin_version",s.plugin_version,2]),window._gaq.push(["sr._setDomainName",window.location.host]),t.log("Tracking pageview"),window._gaq.push(["sr._trackPageview"]),t.log("Loading ga.js script"),e(["ga"],function(){r.initialized=!0,n.each(r.queue,function(e){r.setup_listeners(e)}),t.log("Finished")})},s.track_event=function(e,n,r){t.log("Tracking: "+e+", "+n+", "+r);if(window._sr.site.analytics_disabled===!0)return t.log("Analytics has been disabled on this site: STOP"),!1;window._gaq.push(["sr._trackEvent",e,n,r])},s.setup_listeners=function(e){if(this.initialized===!1)t.log("Analytics not yet initialized, queue "+e),this.queue.push(e);else{var s=this;t.log("Setting up '"+e+"' listeners",0);var o=r[e];if(!o)return t.log("No listeners found"),!1;n.each(o,function(r){n.each(r.actions,function(n){t.log("Setting up listener:"),t.log("category: '"+e+"'",2),t.log("action: '"+n+"'",2),t.log("label: '"+r.label+"'",2),t.log("selector: '"+r.selector+"'",2),i(r.selector).on(n,function(){s.track_event(e,n,r.label)})})})}},s}),define("app/helpers/time",[],function(){var e={};return e.relative=function(e){var t,n,r,i,s,o,u;return u=(new Date(e)).getTime(),i=6e4,r=i*60,n=r*24,s=n*30,o=n*365,t=(new Date).getTime()-u,t<i?Math.round(t/1e3)+" seconds ago":t<r?Math.round(t/i)+" minutes ago":t<n?Math.round(t/r)+" hours ago":t<s?Math.round(t/n)+" days ago":t<o?Math.round(t/s)+" months ago":Math.round(t/o)+" years ago"},e}),define("app/helpers/sample-data",["require","app/helpers/debugger","app/helpers/url-param"],function(e,t,n){var r={};return r.is_on=function(){return n.exists("sr_sample_data")?!0:!1},r.reads={data:[{id:"10152353237580383",from:{name:"Bridget Clay",id:"509762020"},start_time:"2012-12-15T21:22:08+0000",end_time:"2012-12-15T21:22:08+0000",publish_time:"2012-12-15T21:22:08+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"304735542977218",url:"http://localhost:8888/wordpress/hello-world/",type:"article",title:"Hartley gets its own Dating Service"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152337507880383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-12-09T22:12:39+0000",end_time:"2012-12-09T22:12:39+0000",publish_time:"2012-12-09T22:12:39+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"378252925592550",url:"http://localhost:8888/wordpress/rewarw/",type:"article",title:"Comments of the Week #2"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152325332405383",from:{name:"Jenna Brown",id:"513449780"},start_time:"2012-12-04T20:10:08+0000",end_time:"2012-12-04T20:10:08+0000",publish_time:"2012-12-04T20:10:08+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"394572300623745",url:"http://localhost:8888/wordpress/rewarw/",type:"article",title:"How To Pull at Jesters"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152319464040383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-12-02T14:04:00+0000",end_time:"2012-12-02T14:04:00+0000",publish_time:"2012-12-02T14:04:00+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"311512682286598",url:"http://sotontab.co.uk/news/2012/12/02/susu-disability-officer-guilty-of-hacking/",type:"article",title:"SUSU Disability Officer Guilty of HACKING"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152291691295383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-21T18:05:45+0000",end_time:"2012-11-21T18:05:45+0000",publish_time:"2012-11-21T18:05:45+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"502687413098147",url:"http://sotontab.co.uk/news/2012/11/21/nus-referendum-the-polls-so-far/",type:"article",title:"NUS Referendum: The Polls So Far"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152265885575383",from:{name:"Abi Houghton",id:"1844202473"},start_time:"2012-11-11T17:09:51+0000",end_time:"2012-11-11T17:09:51+0000",publish_time:"2012-11-11T17:09:51+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"174390416033247",url:"http://knaqu.org/video-shokuese-shikoni-se-qfar-veprimi-ben-barack-obama/",type:"article",title:"Video Shokuese! Shikoni se qfar veprimi ben Barack Obama"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152265261350383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-11T12:06:41+0000",end_time:"2012-11-11T12:06:41+0000",publish_time:"2012-11-11T12:06:41+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"203202176481809",url:"http://sotontab.co.uk/pictures/2012/11/11/the-damming-truth-reasons-not-to-wear-a-poppy/",type:"article",title:"THE DAMNING TRUTH: Reasons NOT to wear a poppy…"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152265025840383",from:{name:"George Marneros",id:"504855756"},start_time:"2012-11-11T08:17:55+0000",end_time:"2012-11-11T08:17:55+0000",publish_time:"2012-11-11T08:17:55+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"383395001741841",url:"http://sotontab.co.uk/lifestyle/2012/11/08/the-students-guide-to-gold-digging-part-1/",type:"article",title:"A Student’s Guide to GOLD-DIGGING: Part 1"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152264160565383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-10T22:18:59+0000",end_time:"2012-11-10T22:18:59+0000",publish_time:"2012-11-10T22:18:59+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"137881086359855",url:"http://sotontab.co.uk/headline/2012/11/10/supporting-local-talent-underplay-at-the-railway/",type:"article",title:"Supporting Local Talent: UNDERPLAY at The Railway"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152251063655383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-05T22:53:18+0000",end_time:"2012-11-05T22:53:18+0000",publish_time:"2012-11-05T22:53:18+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"284206321696653",url:"http://www.welovefilm.co/news/hollywoodnews/les-miserables-reveals-two-new-posters/",type:"article",title:"Les Miserables Reveals Two New Posters - We Love Film"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152251060095383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-05T22:51:49+0000",end_time:"2012-11-05T22:51:49+0000",publish_time:"2012-11-05T22:51:49+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"106516732845751",url:"http://www.cineview.eu/nadprevarata-vsichko-nai-novo-i-interesno-za-tazgodishnite-nagradi-oskar/",type:"article",title:"“Надпреварата” – всичко най-ново и интересно за тазгодишните награди Оскар"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152245729260383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T21:17:35+0000",end_time:"2012-11-03T21:17:35+0000",publish_time:"2012-11-03T21:17:35+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"391701740901431",url:"http://sotontab.co.uk/degree-break/2012/10/09/freshers-ball-proposal/",type:"article",title:"Freshers Ball PROPOSAL"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152245728785383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T21:17:17+0000",end_time:"2012-11-03T21:17:17+0000",publish_time:"2012-11-03T21:17:17+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"128041100676947",url:"http://sotontab.co.uk/entertainment/2012/10/12/free-music-tour-hits-southampton/",type:"article",title:"FREE Music Tour Hits Southampton"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152245727970383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T21:16:56+0000",end_time:"2012-11-03T21:16:56+0000",publish_time:"2012-11-03T21:16:56+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"528029543893507",url:"https://sotontab.co.uk/news/2012/11/03/roosters-on-fire-2/",type:"article",title:"Roosters on FIRE"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152244659255383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T11:38:24+0000",end_time:"2012-11-03T11:38:24+0000",publish_time:"2012-11-03T11:38:24+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"356711524422389",url:"http://sotontab.co.uk/news/2012/11/02/fire-closes-portswood-road/",type:"article",title:"Fire Closes Portswood Road"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152244627910383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T11:11:20+0000",end_time:"2012-11-03T11:11:20+0000",publish_time:"2012-11-03T11:11:20+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"303047316475385",url:"https://sotontab.co.uk/lifestyle/2012/11/03/the-palace-of-dreams-to-the-man-of-your-dreams-in-5-easy-steps/",type:"article",title:"The Palace of Dreams to the Man of your Dreams…in 5 Easy Steps!"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152219115440383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-25T19:36:28+0000",end_time:"2012-10-25T19:36:28+0000",publish_time:"2012-10-25T19:36:28+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"329881983775853",url:"http://sotontab.co.uk/degree-break/2012/10/25/sleepy-snaps/",type:"article",title:"Sleepy Snaps"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152217820955383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-25T07:16:21+0000",end_time:"2012-10-25T07:16:21+0000",publish_time:"2012-10-25T07:16:21+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"435209399871319",url:"http://sotontab.co.uk/degree-break/2012/10/24/students-dont-know-their-sht/",type:"article",title:"Students Don’t Know Their Sh*t?"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152216463435383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-24T19:09:52+0000",end_time:"2012-10-24T19:09:52+0000",publish_time:"2012-10-24T19:09:52+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"199518523516255",url:"http://sotontab.co.uk/headline/2012/10/23/student-protest-is-timely-and-urgent/",type:"article",title:"Student Protest is Timely and Urgent"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152215554885383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-24T11:21:31+0000",end_time:"2012-10-24T11:21:31+0000",publish_time:"2012-10-24T11:21:31+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"218693958262235",url:"http://sotontab.co.uk/degree-break/2012/10/24/whatsoc-cake-decorating/",type:"article",title:"WHATSOC? Cake Decorating!"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152211427880383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-22T20:35:59+0000",end_time:"2012-10-22T20:35:59+0000",publish_time:"2012-10-22T20:35:59+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"418320004890243",url:"http://sotontab.co.uk/pictures/2012/10/19/review-bloc-party-at-the-guildhall/",type:"article",title:"REVIEW: Bloc Party at the Guildhall"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152208912310383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-21T21:40:59+0000",end_time:"2012-10-21T21:40:59+0000",publish_time:"2012-10-21T21:40:59+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"371017429645843",url:"http://sotontab.co.uk/opinion/2012/10/11/no-to-nus-doomed-from-the-start/",type:"article",title:"No to NUS Doomed from the Start?"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152207624260383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-21T13:26:58+0000",end_time:"2012-10-21T13:26:58+0000",publish_time:"2012-10-21T13:26:58+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"165689946903176",url:"https://sotontab.co.uk/news/2012/10/19/greyhound-to-be-put-down/",type:"article",title:"Greyhound to be Put Down"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}}],paging:{next:"https://graph.facebook.com/578040382/news.reads?limit=25&offset=25&__after_id=10152207624260383"}},r}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!app/html/lightbox.html",[],function(){return"<h3>Recent activity</h3>\n<a id='sr_close_lightbox'>Close</a>\n<div id='sr_loading'>\n  <img src='<%= site.plugin_url %>/images/ajax-loader.gif' alt='Loading...'>\n</div>\n<ul id='sr_activity_tabs'>\n  <li id='sr_lightbox_everyone' class='sr_active_tab'><a>Everyone</a></li>\n  <li id='sr_lightbox_me'><a>Just you</a></li>\n</ul>\n<div id='sr_reads_list'>\n  <ul>\n  </ul>\n  <div id='sr_reads_empty'>\n    None of your friends have read anything on this site yet.\n  </div>\n</div>"}),define("text!app/html/lightbox-read.html",[],function(){return"<% \n  if (from.id === window._sr.user.id) {\n    story_type = 'sr_me_story';\n  } else {\n    story_type = 'sr_friend_story';\n  }\n%>\n\n<li id='sr_read_<%= id %>' class='<%= story_type %>'>\n  <a class='name' href='//facebook.com/<%= from.id %>' target='blank'>\n    <img class='story-img' src='https://graph.facebook.com/<%= from.id %>/picture' width='50' height='50' alt='<%= from.name %>' />\n  </a>\n<div class='story-inner'>\n  <div class='story-title'>\n    <a class='name' href='//facebook.com/profile.php?id=<%= from.id %>' target='blank'><%= from.name %></a> \n    read \n    <a class='article' href='<%= data.article.url %>' target='blank'><%= data.article.title %></a>\n  </div>\n  <div class='story-meta'><%= relative_time %> <span class='sr_story_delete_text'>&middot; <a class='sr_story_delete'>Delete</a></span>\n  </div>\n</div>\n<div class='sr_clear'>\n</div>\n</li>"}),define("app/controllers/lightbox",["require","app/helpers/debugger","app/models/fb","app/helpers/time","app/models/analytics","app/helpers/sample-data","underscore","jquery","text!app/html/lightbox.html","text!app/html/lightbox-read.html"],function(e){var t=e("app/helpers/debugger"),n=e("app/models/fb"),r=e("app/helpers/time"),i=e("app/models/analytics"),s=e("app/helpers/sample-data"),o=e("underscore"),u=e("jquery"),a=e("text!app/html/lightbox.html"),f=e("text!app/html/lightbox-read.html"),l={};return l.load=function(){var e=window._sr.user,n=window._sr.site,r=window._sr.friends,i=window._sr.activity;return t.log("Loading the lightbox",0),e?(t.log("Prepending lightbox to <body>"),u("<div/>",{id:"sr_lightbox",html:"<div id='sr_lightbox_inner'></div>"}).prependTo("body"),u("#sr_lightbox_inner").length!==0?t.log("Lightbox added: SUCCESS"):t.log("Lightbox added: FAILURE"),t.log("Finished")):(t.log("User is not logged in, don't load it"),t.log("Finished"),!1)},l.setup_listeners=function(){var e=this;t.log("Setup jQuery listener for close lightbox link click"),u("a#sr_close_lightbox").on("click",function(){return e.close()})},l.show=function(e,n){var r=this;return t.log("Fade in lightbox",0),t.log("Fading"),u("#sr_lightbox").fadeIn("fast",function(){r.show_activity(e,n),r.setup_listeners(),i.setup_listeners("lightbox")})},l.close=function(){if(this.closing===!0)return;this.closing=!0;var e=this;return t.log("Closing lightbox",0),t.log("Fading out"),u("#sr_lightbox").fadeOut(function(){u("#sr_lightbox #sr_lightbox_inner").html(""),t.log("Html lightbox inner set to blank"),t.log("Finished"),delete e.closing})},l.show_activity=function(){var e=this,i=o.template(a),l=i(window._sr);u("#sr_lightbox_inner").html(l),t.log("Putting reads into the lightbox",0);var c;s.is_on()?c=s.reads:c=n.put_all_reads_in_one_array(window._sr.activity.reads),u("#sr_loading").hide();if(!!c&&!!c.length){t.log("Found "+c.length+" reads");var h="",p=o.template(f);return o.each(c,function(e){if(!e.data||!e.data.article||!e.publish_time)return;e.relative_time=r.relative(e.publish_time),h+=p(e)}),u("#sr_reads_list ul").html(h),t.log("Html put: SUCCESS"),t.log("Showing stuff"),u("#sr_activity_tabs").show(),u("#sr_reads_list").show(),t.log("Adding jQuery listener for filter tabs"),u("#sr_activity_tabs a").on("click",function(){return t.log("Lightbox activity tab click detected",0),u("#sr_activity_tabs li").removeClass("sr_active_tab"),t.log("Removed class from existing tab"),u(this).closest("li").addClass("sr_active_tab"),t.log("Added class to the clicked tab"),u(this).closest("li").attr("id")==="sr_lightbox_everyone"?(t.log("Everyone tab detected, show all stories"),u("#sr_reads_list ul li").show()):u(this).closest("li").attr("id")==="sr_lightbox_me"&&(t.log("Me tab detected, just show my stories"),u("#sr_reads_list ul li.sr_friend_story").hide()),t.log("Finished")}),t.log("Adding jQuery listener for deleting reads"),u(".sr_story_delete").on("click",function(){var e;return e=u(this).closest("li").attr("id").replace("sr_read_",""),n.delete_read(e,function(t){return u("#sr_read_"+e).fadeOut(function(){return u("#sr_read_"+e).remove()})})}),t.log("Finished")}t.log("No reads found"),u("#sr_reads_list").show(),u("#sr_reads_list #sr_reads_empty").show()},l}),define("text!app/html/sidebar-logged-in.html",[],function(){return"<div id='sr_sidebar_logged_in'>\n  <a id='sr_sidebar_img' target='blank' href='<%= user.link %>'><img src='<%= user.picture %>' width='50' height='50' alt='<%= user.name %>'/></a>\n  <div id='sr_sidebar_right'>\n    <div id='sr_sidebar_name'>\n      <a target='blank' href=\"<%= user.link %>\" ><%= user.name %></a>\n    </div>\n    <div id='sr_sidebar_promo'><%= site.login_meta %></div>\n    <div id='sr_sidebar_logout'><a><%= site.logout %></a></div>\n  </div>\n  <div class='clear'>\n  </div>\n  <div id='sr_sidebar_bottom'>\n    <% if (user.is_auto_sharing) { %>\n      <div class='sr_sidebar_toggle sr_sidebar_toggled_on'>\n        <a title='Auto sharing to Facebook is enabled'><%= site.auto_sharing_on %></a>\n      </div>\n    <% } else { %>\n      <div class='sr_sidebar_toggle sr_sidebar_toggled_off'>\n        <a title='Auto sharing to Facebook is disabled'><%= site.auto_sharing_off %></a>\n      </div>\n    <% } %>\n    <div id='sr_sidebar_activity'>\n      <a><%= site.activity %></a>\n    </div>\n  </div>\n</div>"}),define("text!app/html/sidebar-logged-out.html",[],function(){return"<div id='sr_sidebar_logged_out'>\n  <p><%= site.login_promo %></p>\n  <a id='sr_sidebar_login'><img src='<%= site.plugin_url %>/images/facebooklogin.jpg' width='180' height='40'/></a>\n</div>"}),define("app/controllers/sidebar",["require","app/helpers/debugger","app/models/user","app/controllers/lightbox","app/models/analytics","underscore","jquery","text!app/html/sidebar-logged-in.html","text!app/html/sidebar-logged-out.html"],function(e){var t=e("app/helpers/debugger"),n=e("app/models/user"),r=e("app/controllers/lightbox"),i=e("app/models/analytics"),s=e("underscore"),o=e("jquery"),u=e("text!app/html/sidebar-logged-in.html"),a=e("text!app/html/sidebar-logged-out.html"),f={};return f.load=function(){var e,n=this,r=window._sr.user,f=window._sr.site;if(o("#sr_sidebar_box").length===0)return t.log("#sr_sidebar_box is not found, cannot load sidebar."),!1;t.log("Loading the sidebar",0);if(r){r.is_auto_sharing===!0?e="sr_sidebar_toggled_on":e="sr_sidebar_toggled_off",t.log("User auto-sharing is set to: "+r.is_auto_sharing),t.log("Putting html");var l=s.template(u),c=l(window._sr);o("#sr_sidebar_box").html(c),o("#sr_sidebar_box").html()!==""?(t.log("Html put: SUCCESS"),o("#sr_sidebar_box").fadeIn(function(){n.setup_logged_in_listeners(),i.setup_listeners("sidebar_logged_in"),t.log("Finished")})):t.log("Html put: FAILURE")}else{t.log("User is not logged in, show login button"),t.log("Putting html");var h=s.template(a),p=h(window._sr);o("#sr_sidebar_box").html(p),o("#sr_sidebar_box").html()!==""?(t.log("Html put: SUCCESS"),o("#sr_sidebar_box").fadeIn(function(){t.log("Adding jQuery listener for login button click"),n.setup_logged_out_listeners(),i.setup_listeners("sidebar_logged_out"),t.log("Finished")})):t.log("Html put: FAILURE")}},f.setup_logged_in_listeners=function(){var e=this;t.log("Setup jQuery listener for toggle auto-sharing link click"),o("#sr_sidebar_box .sr_sidebar_toggle").on("click",function(){e.toggle_auto_sharing(o(this))}),t.log("Setup jQuery listener activity link click"),o("#sr_sidebar_box #sr_sidebar_activity").on("click",function(){r.show("all_activity",n)}),t.log("Setup jQuery listener for logout link click"),o("#sr_sidebar_box #sr_sidebar_logout").on("click",function(){n.logout()})},f.setup_logged_out_listeners=function(){o("#sr_sidebar_box #sr_sidebar_login").on("click",function(){o(this).css("opacity",.7),n.login()})},f.toggle_auto_sharing=function(e){e.attr("class").match(/sr_sidebar_toggled_on/)?(e.removeClass("sr_sidebar_toggled_on"),e.addClass("sr_sidebar_toggled_off"),n.set_auto_sharing(!1)):e.attr("class").match(/sr_sidebar_toggled_off/)&&(e.removeClass("sr_sidebar_toggled_off"),e.addClass("sr_sidebar_toggled_on"),n.set_auto_sharing(!0))},f}),define("app/helpers/single-format",["require","underscore"],function(e,t){var n={};return n.names_list=function(e,t){var n=this;this.user=e,t=this.check(t,e),this.reads=t,count=this.reads.length;var r="";return r+='<div class="sr_read_names">',count===0?r+="None of your friends have read this yet":count===1?r+=this.name(t[0],e)+" read this":count===2?r+=this.name(t[0],e)+" and "+this.name(t[1],e)+" read this":count===3?(r+=this.name(t[0],e)+", ",r+=this.name(t[1],e)+" and ",r+=this.name(t[2],e)+" read this"):(r+=this.name(t[0],e)+", ",r+=this.name(t[1],e)+" and ",r+=count-2+" others read this"),r+="</div>",r},n.name=function(e,t){return!e.from||!e.from.id||!e.from.name||!t.id?"":e.from.id===t.id?"You":'<a target="blank" href="//facebook.com/'+e.from.id+'">'+e.from.name+"</a>"},n.thumbs_list=function(e,n){n=this.check(n,e);var r="";return r+='<div class="sr_read_thumbs">',t.each(n,function(e){r+='<a target="blank" href="//facebook.com/'+e.from.id+'" title="'+e.from.name+'">',r+="<img src='//graph.facebook.com/"+e.from.id+"/picture' width='35' height='35' alt='"+e.from.name+"' />",r+="</a>"}),r+="</div>",r},n.check=function(e,n){var r=[];return e=t.filter(e,function(e){if(t.indexOf(r,e.from.id)===-1)return r.push(e.from.id),!0}),e=t.sortBy(e,function(e){return e.from.id==n.id?1:2}),e},n}),define("app/controllers/single",["require","underscore","app/helpers/debugger","app/helpers/single-format","app/models/analytics","app/helpers/sample-data","jquery","app/models/fb"],function(e){var t=e("underscore"),n=e("app/helpers/debugger"),r=e("app/helpers/single-format"),i=e("app/models/analytics"),s=e("app/helpers/sample-data"),o=e("jquery"),u=e("app/models/fb"),a={};return a.load=function(){var e=window._sr.user,a=window._sr.activity;if(!e)return;n.log("Loading friends who read this widget",0);if(o("#sr_friends_single").length===0)n.log("#sr_friends_single not found, cannot load");else{n.log("#sr_friends_single found, start loading");var f;if(s.is_on())f=s.reads.data;else{if(!a){n.log("No reads found"),n.log("Finished");return}f=u.put_all_reads_in_one_array()}var l=t.filter(f,function(e){var t=new RegExp(window.location.pathname,"gi");if(!e.data||!e.data.article||!e.data.article.url)return!1;if(t.test(e.data.article.url))return!0});n.log("Creating the names list html string");var c=r.names_list(e,l);n.log("Creating the thumbs list html string");var h=r.thumbs_list(e,l),p=c+h;n.log("Fading in"),o("#sr_friends_single").html(p).fadeIn(function(){i.setup_listeners("frs_single"),n.log("Finished")})}},a}),define("app/main",["require","jquery","app/tests/main","app/models/user","app/models/analytics","app/controllers/sidebar","app/controllers/lightbox","app/controllers/single"],function(e){var t=e("jquery"),n=e("app/tests/main"),r=e("app/models/user"),i=e("app/models/analytics"),s=e("app/controllers/sidebar"),o=e("app/controllers/lightbox"),u=e("app/controllers/single");t(document).ready(function(){n.are_on()?n.start():r.init(function(){s.load()},function(){o.load(),u.load(),i.init()})})});var appUrl=require.toUrl("app"),arr=appUrl.split("/");arr.pop();var dir=arr.join("/");requirejs.config({baseUrl:dir,paths:{app:dir+"/app",underscore:dir+"/lib/underscore-amd.min",ga:"https://google-analytics.com/ga",text:dir+"/lib/text",jquery:dir+"/lib/jquery",jquery_cdn:"https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min",json2:"http://cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.min"}}),requirejs(["app/main"]),define("app",function(){});