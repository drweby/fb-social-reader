define("app/helpers/url-param",[],function(){var e={};return e.exists=function(e){var t,n,r,i,s,o;n=window.location.search.substring(1),s=0,o="?";if(n.length>0){i=n.split("&"),r=0;while(r<i.length){t=i[r].split("=");if(t[0]===e)return!0;r++}}return!1},e}),define("app/helpers/debugger",["app/helpers/url-param"],function(e){var t={};return t.start=function(){return e.exists("sr_debug")?(this.debug_mode=!0,console.log("***********************************************\n* Welcome to the Social Reader debug console! *\n***********************************************")):this.debug_mode=!1},t.log=function(e,t){t==null&&(t=1);if(this.debug_mode===!0){if(t===1)return console.log("  * "+e);if(t===2)return console.log("    - "+e);if(t===0)return console.log("\n"+e+":")}},t.start(),t}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.3";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t){return x.isEmpty(t)?[]:x.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0==t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=M(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),x.isFunction=function(e){return"function"==typeof e},x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=""+ ++P;return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){n=x.defaults({},n,x.templateSettings);var r=RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=u+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,x);var a=function(e){return o.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),define("app/tests/main",["require","app/helpers/debugger","app/helpers/url-param","underscore"],function(e,t,n,r){var i={};return i.modules=["helpers/cookie","helpers/single-format"],i.are_on=function(){return t.log("Seeing if we're running tests"),n.exists("sr_tests")?(t.log("Testing is ON"),!0):(t.log("Testing is OFF"),!1)},i.start=function(){var n=this;t.log("Finished loading qunit.js"),r.each(n.modules,function(n){e(["app/tests/"+n],function(e){t.log("Loaded app/tests/"+n+", now run it"),e.run()})})},i}),define("app/helpers/cookie",["require"],function(){var e={};return e.set=function(e,t,n){var r,i;return i=new Date,i.setDate(i.getDate()+n),r=escape(t)+(n==null?"":"; expires="+i.toUTCString()),document.cookie=e+"="+r},e.get=function(e){var t,n,r,i;t=document.cookie.split(";"),n=0;while(n<t.length){r=t[n].substr(0,t[n].indexOf("=")),i=t[n].substr(t[n].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,"");if(r===e)return unescape(i);n++}return!1},e.exists=function(e){return this.get(e)?!0:!1},e.remove=function(e){return document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e}),define("app/models/cache",["require","app/helpers/debugger","app/helpers/cookie"],function(e,t,n){var r={};return r.save=function(e,r,i,s){t.log("Saving "+r+" to the database cache",0);var o=this,u=JSON.stringify(i);return $.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"save_cache",fb_id:e,field:r,data:u},function(e){t.log("Ajax request complete"),e=="1"?(t.log(r+" saved successfully"),n.set("sr_"+r,"true",null),t.log("Set cookie marking "+r+" as saved this session"),t.log("Finished"),s!==null&&s()):(t.log("Data failed to save:"),console.log(e),t.log("Finished"),s!==null&&s())})},r.get=function(e,n,r){var i=this;return t.log("Getting the "+n),$.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"get_cache",fb_id:e,field:n},function(e){t.log("Ajax request complete"),t.log("Converting data to json object");try{var n=JSON.parse(e);t.log("JSON parsed: SUCCESS"),t.log("Finished"),r!==null&&r(n)}catch(i){t.log("JSON parsed: FAILURE"),t.log("Finished"),r!==null&&r()}})},r.refresh=function(){t.log("Refreshing cache by deleting cookies",0),n.remove("sr_activity_cache"),n.remove("sr_friends_cache")},r}),define("app/models/fb",["require","app/helpers/debugger","app/helpers/cookie","app/models/cache"],function(e,t,n,r){var i={user:{},friends:[],activity:{}};return i.init=function(e,n){var r=this,i=e.fb_app_id,s=e.fb_channel_url,o=e.fb_sdk_disable;t.log("Initiliazing Facebook",0);if(o!="on")return $("body").prepend('<div id="fb-root"></div>'),t.log("Prepended div fb-root to body"),window.fbAsyncInit=function(){return t.log("Loading the SDK asynchronously with app id: "+i+", channel url: "+s),FB.init({appId:i,channelUrl:s,status:!0,cookie:!0,xfbml:!0}),t.log("SDK loaded"),t.log("Finished"),n()},function(e,t){var n,r,i;r=void 0,n="facebook-jssdk",i=e.getElementsByTagName("script")[0];if(e.getElementById(n))return;return r=e.createElement("script"),r.id=n,r.async=!0,r.src="//connect.facebook.net/en_US/all"+(t?"/debug":"")+".js",i.parentNode.insertBefore(r,i)}(window.document,!1);t.log("SDK loading disabled, wait for it to exist"),this.sdk_check_count=0,this.wait_for_fb(function(){t.log("SDK loaded"),n()})},i.wait_for_fb=function(e){this.sdk_check_count++;if(this.sdk_check_count>10){t.log("Facebook SDK loading: FAILURE");return}var n=this;window.FB?(t.log(n.sdk_check_count+": window.FB exists: SUCCESS"),$("#fb-root").length===1?(t.log('<div id="fb-root"></div> exists: SUCCESS'),e()):(t.log(n.sdk_check_count+': <div id="fb-root"></div> does not exist, try again in 100ms'),setTimeout(function(){n.wait_for_fb()},100))):(t.log(n.sdk_check_count+": window.FB does not exist, try again in 100ms"),setTimeout(function(){n.wait_for_fb()},100))},i.is_logged_in=function(e){var n=this;return t.log("See if user is logged in to Facebook and the app",0),t.log("Query Facebook"),FB.getLoginStatus(function(r){return t.log("Response from Facebook received"),r.status==="connected"?(t.log("User is logged in"),n.user.logged_in=!0,t.log("Finished"),e(!0)):(t.log("User is not logged in"),n.user.logged_in=!1,t.log("Finished"),e(!1))})},i.get_user=function(e){var n=this;return t.log("Get Facebook user",0),t.log("Querying Facebook"),FB.api("/me",function(r){return t.log("Response received, setting values"),n.user.id=r.id,n.user.name=r.name,n.user.link=r.link,n.user.picture="//graph.facebook.com/"+r.id+"/picture",t.log("Finished"),e(n.user)})},i.login=function(e){var n=this;return t.log("Logging in the user to Facebook",0),FB.login(function(n){t.log("Response received from Facebook");if(n.status!=="connected")return t.log("User cancelled login or did not fully authorize.");t.log("Logged in successfully"),e()},{scope:"publish_actions"})},i.logout=function(e){var n=this;return t.log("Logging the user out of Facebook",0),FB.logout(function(n){t.log("Logout successful"),t.log("Removing cached coookie NEED TO DO THIS"),t.log("Reloading the page"),e()})},i.add_read=function(){var e=this;return t.log("Adding user read",0),FB.api("/me/news.reads?article="+document.URL,"post",function(e){t.log("Response received from Facebook"),e.id?(t.log("Read "+e.id+" posted to Facebook: SUCCESS"),r.refresh()):(t.log("Read posted to Facebook: FAILURE"),t.log("Error message from Facebook: "+e.error.message+" ")),t.log("Finished")})},i.delete_read=function(e,n){var i=this;return t.log("Deleting user read",0),FB.api("/"+e,"delete",function(e){return t.log("Response received from Facebook"),e===!0?(t.log("Read deleted from Facebook: SUCCESS"),r.refresh()):(t.log("Read deleted from Facebook: FAILURE"),t.log("Error message from Facebook: "+e.error.message)),n()})},i.get_friend_users=function(e){var i=this;t.log("Get Facebook friends using the app",0);if(!n.exists("sr_friends_cache"))return t.log("Friends not in cache, querying Facebook"),FB.api("/me/friends?fields=name,installed",function(n){var s,o,u,a;t.log("Response received, finding friend users"),a=n.data;for(o=0,u=a.length;o<u;o++)s=a[o],s.installed===!0&&(delete s.installed,i.friends.push(s));t.log(""+i.friends.length+" friends found"),t.log("Finished"),r.save(i.user.id,"friends_cache",i.friends,function(){e(i.friends)})});t.log("Friends in cache, get from server"),r.get(i.user.id,"friends_cache",function(t){i.friends=t,e!==null&&e(i.friends)})},i.get_activity=function(e){var i,s,o,u,a,f=this;t.log("Getting activity of you and friends",0);if(!n.exists("sr_activity_cache")){t.log("Activity reads does not exist, create and fetch from Facebook"),t.log("Creating batch array"),i=[],i.push({method:"GET",relative_url:"me/news.reads?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from"}),a=this.friends;for(o=0,u=a.length;o<u;o++)s=a[o],i.push({method:"GET",relative_url:""+s.id+"/news.reads?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from"});return t.log("Starting batch requests for the "+this.friends.length+" friends using this app"),FB.api("/","POST",{batch:i},function(n){var i,s,o,u,a,l,c,h;t.log("Response received from Facebook"),f.activity.reads=[],t.log("Adding reads to reads param array");for(u=0,l=n.length;u<l;u++){o=n[u];if(!o||!o.body)continue;i=JSON.parse(o.body),h=i.data;for(a=0,c=h.length;a<c;a++)s=h[a],f.activity.reads.push(s)}t.log("Sorting the reads by publish_time descending"),f.activity.reads=f.activity.reads.sort(function(e,t){return e=new Date(e.publish_time),t=new Date(t.publish_time),e>t?-1:e<t?1:0}),t.log("Finished"),r.save(f.user.id,"activity_cache",f.activity,function(){e(f.activity)})})}t.log("Activity in cache, get from server"),r.get(f.user.id,"activity_cache",function(t){f.activity=t,e!==null&&e(f.activity)})},i}),define("app/models/user",["require","app/models/fb","app/helpers/cookie","app/helpers/debugger"],function(e,t,n,r){var i=jQuery,s={};return s.init=function(e,n){var r=this;this.site={},this.user={},this.friends=[],this.activity={},this.get_client_details(function(){t.init(r.site,function(){t.is_logged_in(function(i){i===!0?t.get_user(function(s){r.user=s,r.user.logged_in=i,r.is_auto_sharing(function(){e(),t.get_friend_users(function(e){r.friends=e,t.get_activity(function(e){r.activity=e,r.queue_read(function(){n()})})})})}):(e(),n())})})})},s.queue_read=function(e){return r.log("Queuing auto-read to Facebook",0),this.user.auto_sharing===!0?(r.log("Is auto sharing?: TRUE"),i.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"is_readable",url:window.location.href},function(n){r.log("Ajax request complete");if(n=="1"||n=="0")return r.log("Format correct?: SUCCESS"),n=="1"?(r.log("Auto-sharing for this page is: ON"),setTimeout(function(){t.add_read()},1e4)):r.log("Auto-sharing for this page is: OFF"),r.log("Finished"),e();r.log("Format correct?: FAILURE")})):(r.log("Is auto sharing?: FALSE"),r.log("Finished"),e())},s.get_client_details=function(e){var t=this;return r.log("Getting client site details",0),i.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"get_client_details"},function(n){return r.log("Ajax request complete"),t.site=JSON.parse(n),t.site?r.log("Read from ajax request data: SUCCESS"):r.log("Read from ajax request data: FAILURE"),r.log("Finished"),e()})},s.is_auto_sharing=function(e){var t=this;return r.log("See if we're auto sharing"),i.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"is_auto_sharing",fb_id:this.user.id},function(n){return r.log("Ajax request complete"),n=="1"||n=="0"?(r.log("SUCCESS, set param"),n==1?n=!0:n=!1,t.user.auto_sharing=n,r.log("Finished")):(r.log("Data format is incorrect. FAILURE"),console.log(n)),e()})},s.set_auto_sharing=function(e){var t=this;return r.log("Setting auto sharing",0),r.log("Changing auto sharing to "+e),i.post(_sr_ajax.ajaxurl,{action:"_sr_ajax_hook",type:"set_auto_sharing",fb_id:this.user.id,is_auto_sharing:e},function(e){r.log("Ajax request complete"),e==1?r.log("Auto sharing change: SUCCESS"):r.log("Auto sharing change: FAILURE"),r.log("Finished")})},s.login=function(){t.login(function(){window.location.reload()})},s.logout=function(){t.logout(function(){n.remove("sr_activity_cache"),n.remove("sr_friends_cache"),window.location.reload()})},s}),define("app/models/analytics-listeners",[],function(){var e={};return e.sidebar_logged_in=[{selector:"#sr_sidebar_activity a",actions:["click","mouseenter"],label:"Activity"},{selector:".sr_sidebar_toggle",actions:["click","mouseenter"],label:"Toggle auto-sharing"},{selector:"a#sr_sidebar_img",actions:["click","mouseenter"],label:"Profile picture"},{selector:"#sr_sidebar_name",actions:["click","mouseenter"],label:"Profile name"},{selector:"#sr_sidebar_logout a",actions:["click","mouseenter"],label:"Logout"}],e.sidebar_logged_out=[{selector:"a#sr_sidebar_login",actions:["click","mouseenter"],label:"Login button"}],e.frs_single=[{selector:".sr_read_names a",actions:["click","mouseenter"],label:"Name"},{selector:".sr_read_thumbs a",actions:["click","mouseenter"],label:"Thumb"}],e.lightbox=[{selector:"a#sr_close_lightbox",actions:["click","mouseenter"],label:"Close"},{selector:"#sr_lightbox_everyone a",actions:["click","mouseenter"],label:"Show everyone tab"},{selector:"#sr_lightbox_me a",actions:["click","mouseenter"],label:"Show me tab"},{selector:"#sr_lightbox_inner li a img.story-img",actions:["click","mouseenter"],label:"Story profile pic"},{selector:"#sr_lightbox_inner li .story-title a.name",actions:["click","mouseenter"],label:"Story user name"},{selector:"#sr_lightbox_inner li .story-title a.article",actions:["click","mouseenter"],label:"Story article title"},{selector:"#sr_lightbox_inner li a.sr_story_delete",actions:["click","mouseenter"],label:"Story delete"}],e}),define("app/models/analytics",["require","app/helpers/debugger","underscore","app/models/analytics-listeners"],function(e,t,n,r){var i={initialized:!1,queue:[]};return i.init=function(r,i){var s=this;this.user=r,this.site=i,t.log("Starting analytics",0);if(this.site.analytics_disabled=="on")return t.log("Analytics has been disabled on this site: STOP"),!1;t.log("Analytics is enabled for this site"),window._gaq=window._gaq||[],window._gaq.push(["sr._setAccount","UA-37231887-1"]),t.log("Setting custom variables"),window._gaq.push(["sr.setCustomVar",1,"logged_in",this.user.logged_in,2]),window._gaq.push(["sr.setCustomVar",2,"plugin_version",this.site.plugin_version,2]),window._gaq.push(["sr._setDomainName",window.location.host]),t.log("Tracking pageview"),window._gaq.push(["sr._trackPageview"]),t.log("Loading ga.js script"),e(["ga"],function(){s.initialized=!0,n.each(s.queue,function(e){s.setup_listeners(e)}),t.log("Finished")})},i.track_event=function(e,n,r){t.log("Tracking: "+e+", "+n+", "+r);if(this.site.analytics_disabled=="on")return t.log("Analytics has been disabled on this site: STOP"),!1;window._gaq.push(["sr._trackEvent",e,n,r])},i.setup_listeners=function(e){if(this.initialized===!1)t.log("Analytics not yet initialized, queue "+e),this.queue.push(e);else{var i=this;t.log("Setting up '"+e+"' listeners",0);var s=r[e];if(!s)return t.log("No listeners found"),!1;n.each(s,function(r){n.each(r.actions,function(n){t.log("Setting up listener:"),t.log("category: '"+e+"'",2),t.log("action: '"+n+"'",2),t.log("label: '"+r.label+"'",2),t.log("selector: '"+r.selector+"'",2),$(r.selector).on(n,function(){i.track_event(e,n,r.label)})})})}},i}),define("app/helpers/time",[],function(){var e={};return e.relative=function(e){var t,n,r,i,s,o,u;return u=(new Date(e)).getTime(),i=6e4,r=i*60,n=r*24,s=n*30,o=n*365,t=(new Date).getTime()-u,t<i?Math.round(t/1e3)+" seconds ago":t<r?Math.round(t/i)+" minutes ago":t<n?Math.round(t/r)+" hours ago":t<s?Math.round(t/n)+" days ago":t<o?Math.round(t/s)+" months ago":Math.round(t/o)+" years ago"},e}),define("app/helpers/sample-data",["require","app/helpers/debugger","app/helpers/url-param"],function(e,t,n){var r={};return r.is_on=function(){return n.exists("sr_sample_data")?!0:!1},r.reads={data:[{id:"10152353237580383",from:{name:"Bridget Clay",id:"509762020"},start_time:"2012-12-15T21:22:08+0000",end_time:"2012-12-15T21:22:08+0000",publish_time:"2012-12-15T21:22:08+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"304735542977218",url:"http://localhost:8888/wordpress/hello-world/",type:"article",title:"Hartley gets its own Dating Service"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152337507880383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-12-09T22:12:39+0000",end_time:"2012-12-09T22:12:39+0000",publish_time:"2012-12-09T22:12:39+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"378252925592550",url:"http://localhost:8888/wordpress/rewarw/",type:"article",title:"Comments of the Week #2"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152325332405383",from:{name:"Jenna Brown",id:"513449780"},start_time:"2012-12-04T20:10:08+0000",end_time:"2012-12-04T20:10:08+0000",publish_time:"2012-12-04T20:10:08+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"394572300623745",url:"http://localhost:8888/wordpress/rewarw/",type:"article",title:"How To Pull at Jesters"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152319464040383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-12-02T14:04:00+0000",end_time:"2012-12-02T14:04:00+0000",publish_time:"2012-12-02T14:04:00+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"311512682286598",url:"http://sotontab.co.uk/news/2012/12/02/susu-disability-officer-guilty-of-hacking/",type:"article",title:"SUSU Disability Officer Guilty of HACKING"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152291691295383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-21T18:05:45+0000",end_time:"2012-11-21T18:05:45+0000",publish_time:"2012-11-21T18:05:45+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"502687413098147",url:"http://sotontab.co.uk/news/2012/11/21/nus-referendum-the-polls-so-far/",type:"article",title:"NUS Referendum: The Polls So Far"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152265885575383",from:{name:"Abi Houghton",id:"1844202473"},start_time:"2012-11-11T17:09:51+0000",end_time:"2012-11-11T17:09:51+0000",publish_time:"2012-11-11T17:09:51+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"174390416033247",url:"http://knaqu.org/video-shokuese-shikoni-se-qfar-veprimi-ben-barack-obama/",type:"article",title:"Video Shokuese! Shikoni se qfar veprimi ben Barack Obama"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152265261350383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-11T12:06:41+0000",end_time:"2012-11-11T12:06:41+0000",publish_time:"2012-11-11T12:06:41+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"203202176481809",url:"http://sotontab.co.uk/pictures/2012/11/11/the-damming-truth-reasons-not-to-wear-a-poppy/",type:"article",title:"THE DAMNING TRUTH: Reasons NOT to wear a poppy…"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152265025840383",from:{name:"George Marneros",id:"504855756"},start_time:"2012-11-11T08:17:55+0000",end_time:"2012-11-11T08:17:55+0000",publish_time:"2012-11-11T08:17:55+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"383395001741841",url:"http://sotontab.co.uk/lifestyle/2012/11/08/the-students-guide-to-gold-digging-part-1/",type:"article",title:"A Student’s Guide to GOLD-DIGGING: Part 1"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152264160565383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-10T22:18:59+0000",end_time:"2012-11-10T22:18:59+0000",publish_time:"2012-11-10T22:18:59+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"137881086359855",url:"http://sotontab.co.uk/headline/2012/11/10/supporting-local-talent-underplay-at-the-railway/",type:"article",title:"Supporting Local Talent: UNDERPLAY at The Railway"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152251063655383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-05T22:53:18+0000",end_time:"2012-11-05T22:53:18+0000",publish_time:"2012-11-05T22:53:18+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"284206321696653",url:"http://www.welovefilm.co/news/hollywoodnews/les-miserables-reveals-two-new-posters/",type:"article",title:"Les Miserables Reveals Two New Posters - We Love Film"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152251060095383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-05T22:51:49+0000",end_time:"2012-11-05T22:51:49+0000",publish_time:"2012-11-05T22:51:49+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"106516732845751",url:"http://www.cineview.eu/nadprevarata-vsichko-nai-novo-i-interesno-za-tazgodishnite-nagradi-oskar/",type:"article",title:"“Надпреварата” – всичко най-ново и интересно за тазгодишните награди Оскар"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152245729260383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T21:17:35+0000",end_time:"2012-11-03T21:17:35+0000",publish_time:"2012-11-03T21:17:35+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"391701740901431",url:"http://sotontab.co.uk/degree-break/2012/10/09/freshers-ball-proposal/",type:"article",title:"Freshers Ball PROPOSAL"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152245728785383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T21:17:17+0000",end_time:"2012-11-03T21:17:17+0000",publish_time:"2012-11-03T21:17:17+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"128041100676947",url:"http://sotontab.co.uk/entertainment/2012/10/12/free-music-tour-hits-southampton/",type:"article",title:"FREE Music Tour Hits Southampton"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152245727970383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T21:16:56+0000",end_time:"2012-11-03T21:16:56+0000",publish_time:"2012-11-03T21:16:56+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"528029543893507",url:"https://sotontab.co.uk/news/2012/11/03/roosters-on-fire-2/",type:"article",title:"Roosters on FIRE"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152244659255383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T11:38:24+0000",end_time:"2012-11-03T11:38:24+0000",publish_time:"2012-11-03T11:38:24+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"356711524422389",url:"http://sotontab.co.uk/news/2012/11/02/fire-closes-portswood-road/",type:"article",title:"Fire Closes Portswood Road"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152244627910383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-11-03T11:11:20+0000",end_time:"2012-11-03T11:11:20+0000",publish_time:"2012-11-03T11:11:20+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"303047316475385",url:"https://sotontab.co.uk/lifestyle/2012/11/03/the-palace-of-dreams-to-the-man-of-your-dreams-in-5-easy-steps/",type:"article",title:"The Palace of Dreams to the Man of your Dreams…in 5 Easy Steps!"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152219115440383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-25T19:36:28+0000",end_time:"2012-10-25T19:36:28+0000",publish_time:"2012-10-25T19:36:28+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"329881983775853",url:"http://sotontab.co.uk/degree-break/2012/10/25/sleepy-snaps/",type:"article",title:"Sleepy Snaps"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152217820955383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-25T07:16:21+0000",end_time:"2012-10-25T07:16:21+0000",publish_time:"2012-10-25T07:16:21+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"435209399871319",url:"http://sotontab.co.uk/degree-break/2012/10/24/students-dont-know-their-sht/",type:"article",title:"Students Don’t Know Their Sh*t?"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152216463435383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-24T19:09:52+0000",end_time:"2012-10-24T19:09:52+0000",publish_time:"2012-10-24T19:09:52+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"199518523516255",url:"http://sotontab.co.uk/headline/2012/10/23/student-protest-is-timely-and-urgent/",type:"article",title:"Student Protest is Timely and Urgent"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152215554885383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-24T11:21:31+0000",end_time:"2012-10-24T11:21:31+0000",publish_time:"2012-10-24T11:21:31+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"218693958262235",url:"http://sotontab.co.uk/degree-break/2012/10/24/whatsoc-cake-decorating/",type:"article",title:"WHATSOC? Cake Decorating!"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152211427880383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-22T20:35:59+0000",end_time:"2012-10-22T20:35:59+0000",publish_time:"2012-10-22T20:35:59+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"418320004890243",url:"http://sotontab.co.uk/pictures/2012/10/19/review-bloc-party-at-the-guildhall/",type:"article",title:"REVIEW: Bloc Party at the Guildhall"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152208912310383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-21T21:40:59+0000",end_time:"2012-10-21T21:40:59+0000",publish_time:"2012-10-21T21:40:59+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"371017429645843",url:"http://sotontab.co.uk/opinion/2012/10/11/no-to-nus-doomed-from-the-start/",type:"article",title:"No to NUS Doomed from the Start?"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}},{id:"10152207624260383",from:{name:"Chris Houghton",id:"578040382"},start_time:"2012-10-21T13:26:58+0000",end_time:"2012-10-21T13:26:58+0000",publish_time:"2012-10-21T13:26:58+0000",application:{name:"Social Reader",namespace:"fb_social_reader",id:"249444298473440"},data:{article:{id:"165689946903176",url:"https://sotontab.co.uk/news/2012/10/19/greyhound-to-be-put-down/",type:"article",title:"Greyhound to be Put Down"}},type:"news.reads",no_feed_story:!1,likes:{count:0,can_like:!0,user_likes:!1},comments:{count:0,can_comment:!0}}],paging:{next:"https://graph.facebook.com/578040382/news.reads?limit=25&offset=25&__after_id=10152207624260383"}},r}),define("app/controllers/lightbox",["require","app/helpers/debugger","app/models/fb","app/helpers/time","app/models/analytics","app/helpers/sample-data"],function(e,t,n,r,i,s){var o={};return o.load=function(e,n){if(e.logged_in!==!0)return;this.user=e,this.site=n;var r=this;return t.log("Loading the lightbox",0),e.logged_in===!1?(t.log("User is not logged in, don't load it"),t.log("Finished"),!1):(t.log("Prepending lightbox to <body>"),$("<div/>",{id:"sr_lightbox",html:"<div id='sr_lightbox_inner'></div>"}).prependTo("body"),$("#sr_lightbox_inner").length!==0?t.log("Lightbox added: SUCCESS"):t.log("Lightbox added: FAILURE"),t.log("Finished"))},o.setup_listeners=function(){var e=this;t.log("Setup jQuery listener for close lightbox link click"),$("a#sr_close_lightbox").live("click",function(){return e.close()})},o.show=function(e,n){var r=this;return t.log("Fade in lightbox",0),t.log("Fading"),$("#sr_lightbox").fadeIn("fast",function(){r.show_activity(e,n),r.setup_listeners(),i.setup_listeners("lightbox")})},o.close=function(){if(this.closing===!0)return;this.closing=!0;var e=this;return t.log("Closing lightbox",0),t.log("Fading out"),$("#sr_lightbox").fadeOut(function(){$("#sr_lightbox #sr_lightbox_inner").html(""),t.log("Html lightbox inner set to blank"),t.log("Finished"),delete e.closing})},o.show_activity=function(e,i){var o=this;$("#sr_lightbox_inner").html("<h3>Recent activity</h3><a id='sr_close_lightbox'>Close</a><div id='sr_loading'><img src='"+this.site.plugin_url+"/images/ajax-loader.gif' alt='Loading...'></div>			<ul id='sr_activity_tabs'>				<li id='sr_lightbox_everyone' class='sr_active_tab'><a>Everyone</a></li>				<li id='sr_lightbox_me'><a>Just you</a></li>			</ul>			<div id='sr_reads_list'><ul></ul><div id='sr_reads_empty'>None of your friends have read anything on this site yet.</div></div>		");var u,a,f,l,c,h;t.log("Putting reads into the lightbox",0);var p;s.is_on()?(console.log(s),p=s.reads):p=i.activity.reads,$("#sr_loading").hide();if(!!p&&!!p.length){t.log("Found "+i.activity.reads.length+" reads"),u="",s.is_on()?h=s.reads.data:h=i.activity.reads;for(l=0,c=h.length;l<c;l++){a=h[l],a.from.id===i.user.id?f="sr_me_story":f="sr_friend_story";if(!a.data||!a.data.article)continue;u+="<li id='sr_read_"+a.id+"' class='"+f+"'>           <a class='name' href='//facebook.com/"+a.from.id+"' target='blank'>              <img class='story-img' src='https://graph.facebook.com/"+a.from.id+"/picture' width='50' height='50' alt='"+a.from.name+"' />           </a>            <div class='story-inner'>             <div class='story-title'>               <a class='name' href='//facebook.com/profile.php?id="+a.from.id+"' target='blank'>                 "+a.from.name+"                </a> read                 <a class='article' href='"+a.data.article.url+"' target='blank'>"+a.data.article.title+"</a>              </div>              <div class='story-meta'>                "+r.relative(a.publish_time)+"                <span class='sr_story_delete_text'>&middot; <a class='sr_story_delete'>Delete</a></span>             </div>            </div>            <div class='sr_clear'></div>          </li>"}return $("#sr_reads_list ul").html(u),t.log("Html put: SUCCESS"),t.log("Showing stuff"),$("#sr_activity_tabs").show(),$("#sr_reads_list").show(),t.log("Adding jQuery listener for filter tabs"),$("#sr_activity_tabs a").on("click",function(){return t.log("Lightbox activity tab click detected",0),$("#sr_activity_tabs li").removeClass("sr_active_tab"),t.log("Removed class from existing tab"),$(this).closest("li").addClass("sr_active_tab"),t.log("Added class to the clicked tab"),$(this).closest("li").attr("id")==="sr_lightbox_everyone"?(t.log("Everyone tab detected, show all stories"),$("#sr_reads_list ul li").show()):$(this).closest("li").attr("id")==="sr_lightbox_me"&&(t.log("Me tab detected, just show my stories"),$("#sr_reads_list ul li.sr_friend_story").hide()),t.log("Finished")}),t.log("Adding jQuery listener for deleting reads"),$(".sr_story_delete").on("click",function(){var e;return e=$(this).closest("li").attr("id").replace("sr_read_",""),n.delete_read(e,function(t){return $("#sr_read_"+e).fadeOut(function(){return $("#sr_read_"+e).remove()})})}),t.log("Finished")}t.log("No reads found"),$("#sr_reads_list").show(),$("#sr_reads_list #sr_reads_empty").show()},o}),define("app/controllers/sidebar",["require","app/helpers/debugger","app/models/user","app/controllers/lightbox","app/models/analytics"],function(e,t,n,r,i){var s={};return s.load=function(e,n){var r,s=this;if($("#sr_sidebar_box").length===0)return t.log("#sr_sidebar_box is not found, cannot load sidebar."),!1;t.log("Loading the sidebar",0),e.logged_in===!0?(t.log("User is logged in"),e.auto_sharing===!0?r="sr_sidebar_toggled_on":r="sr_sidebar_toggled_off",t.log("User auto-sharing is set to: "+e.auto_sharing),t.log("Putting html"),$("#sr_sidebar_box").html("       <div id='sr_sidebar_logged_in'>               <a id='sr_sidebar_img' target='blank' href='"+e.link+"'>            <img src='"+e.picture+"' width='50' height='50' alt='"+e.name+"' />         </a>          <div id='sr_sidebar_right'>           <div id='sr_sidebar_name'><a target='blank' href='"+e.link+"'>"+e.name+"</a></div>            <div id='sr_sidebar_promo'>"+n.login_meta+"</div>           <div id='sr_sidebar_logout'><a>Logout</a></div>         </div>          <div class='clear'></div>         <div id='sr_sidebar_bottom'>            <div class='sr_sidebar_toggle "+r+"'>             <a title='Auto sharing to Facebook is enabled'>"+n.auto_sharing_on+"</a>            </div>            <div id='sr_sidebar_activity'><a>"+n.activity+"</a></div>         </div>        </div>      "),$("#sr_sidebar_box").html()!==""?(t.log("Html put: SUCCESS"),$("#sr_sidebar_box").fadeIn(function(){s.setup_logged_in_listeners(),i.setup_listeners("sidebar_logged_in"),t.log("Finished")})):t.log("Html put: FAILURE")):(t.log("User is not logged in, show login button"),t.log("Putting html"),$("#sr_sidebar_box").html("       <div id='sr_sidebar_logged_out'>                <p>Login and read with your friends</p>          <a id='sr_sidebar_login'><img src='"+n.plugin_url+"/images/facebooklogin.jpg' width='180' height='40' /></a>        </div>      "),$("#sr_sidebar_box").html()!==""?(t.log("Html put: SUCCESS"),$("#sr_sidebar_box").fadeIn(function(){t.log("Adding jQuery listener for login button click"),s.setup_logged_out_listeners(),i.setup_listeners("sidebar_logged_out"),t.log("Finished")})):t.log("Html put: FAILURE"))},s.setup_logged_in_listeners=function(){var e=this;t.log("Setup jQuery listener for toggle auto-sharing link click"),$("#sr_sidebar_box .sr_sidebar_toggle").on("click",function(){e.toggle_auto_sharing($(this))}),t.log("Setup jQuery listener activity link click"),$("#sr_sidebar_box #sr_sidebar_activity").on("click",function(){r.show("all_activity",n)}),t.log("Setup jQuery listener for logout link click"),$("#sr_sidebar_box #sr_sidebar_logout").on("click",function(){n.logout()})},s.setup_logged_out_listeners=function(){$("#sr_sidebar_box #sr_sidebar_login").on("click",function(){$(this).css("opacity",.7),n.login()})},s.toggle_auto_sharing=function(e){e.attr("class").match(/sr_sidebar_toggled_on/)?(e.removeClass("sr_sidebar_toggled_on"),e.addClass("sr_sidebar_toggled_off"),n.set_auto_sharing(!1)):e.attr("class").match(/sr_sidebar_toggled_off/)&&(e.removeClass("sr_sidebar_toggled_off"),e.addClass("sr_sidebar_toggled_on"),n.set_auto_sharing(!0))},s}),define("app/helpers/single-format",["require","underscore"],function(e,t){var n={};return n.names_list=function(e,t){var n=this;this.user=e,t=this.check(t,e),this.reads=t,count=this.reads.length;var r="";return r+='<div class="sr_read_names">',count===0?r+="None of your friends have read this yet":count===1?r+=this.name(t[0],e)+" read this":count===2?r+=this.name(t[0],e)+" and "+this.name(t[1],e)+" read this":count===3?(r+=this.name(t[0],e)+", ",r+=this.name(t[1],e)+" and ",r+=this.name(t[2],e)+" read this"):(r+=this.name(t[0],e)+", ",r+=this.name(t[1],e)+" and ",r+=count-2+" others read this"),r+="</div>",r},n.name=function(e,t){return!e.from||!e.from.id||!e.from.name||!t.id?"":e.from.id===t.id?"You":'<a target="blank" href="//facebook.com/'+e.from.id+'">'+e.from.name+"</a>"},n.thumbs_list=function(e,n){n=this.check(n,e);var r="";return r+='<div class="sr_read_thumbs">',t.each(n,function(e){r+='<a target="blank" href="//facebook.com/'+e.from.id+'" title="'+e.from.name+'">',r+="<img src='//graph.facebook.com/"+e.from.id+"/picture' width='35' height='35' alt='"+e.from.name+"' />",r+="</a>"}),r+="</div>",r},n.check=function(e,n){var r=[];return e=t.filter(e,function(e){if(t.indexOf(r,e.from.id)===-1)return r.push(e.from.id),!0}),e=t.sortBy(e,function(e){return e.from.id==n.id?1:2}),e},n}),define("app/controllers/single",["require","underscore","app/helpers/debugger","app/helpers/single-format","app/models/analytics","app/helpers/sample-data"],function(e,t,n,r,i,s){var o={};return o.load=function(e,o){var u=this;if(e.logged_in!==!0)return;n.log("Loading friends who read this widget",0);if($("#sr_friends_single").length===0)n.log("#sr_friends_single not found, cannot load");else{n.log("#sr_friends_single found, start loading");var a;s.is_on()?a=s.reads.data:a=o.reads;var f=t.filter(a,function(e){var t=new RegExp(window.location.pathname,"gi");if(!e.data||!e.data.article||!e.data.article.url)return!1;if(t.test(e.data.article.url))return!0});n.log("Creating the names list html string");var l=r.names_list(e,f);n.log("Creating the thumbs list html string");var c=r.thumbs_list(e,f),h=l+c;n.log("Fading in"),$("#sr_friends_single").html(h).fadeIn(function(){i.setup_listeners("frs_single"),n.log("Finished")})}},o}),define("app/main",["require","app/tests/main","app/models/user","app/models/analytics","app/controllers/sidebar","app/controllers/lightbox","app/controllers/single"],function(e,t,n,r,i,s,o){$=window.jQuery,$(document).ready(function(){t.are_on()?t.start():n.init(function(){i.load(n.user,n.site)},function(){s.load(n.user,n.site),o.load(n.user,n.activity),r.init(n.user,n.site)})})});var appUrl=require.toUrl("app"),arr=appUrl.split("/");arr.pop();var dir=arr.join("/");requirejs.config({baseUrl:dir+"/lib",paths:{app:dir+"/app",underscore:dir+"/lib/underscore.min",ga:"https://google-analytics.com/ga"}}),requirejs(["app/main"]),define("app",function(){});