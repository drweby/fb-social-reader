define("jquery",["//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"],function(){var e=jQuery.noConflict(!0);return e}),define("underscore",["https://cdnjs.cloudflare.com/ajax/libs/lodash.js/1.0.1/lodash.min.js"],function(e){var e=e.noConflict();return e}),define("backbone",["underscore","jquery"],function(e,t){(function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="0.9.10";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!a.test(n))return!0;var s=n.split(a);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},l=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0]);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1]);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},c=o.Events={on:function(e,t,n){if(!f(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,l=o.length;a<l;a++){e=o[a];if(r=this._events[e]){s=[];if(t||n)for(c=0,h=r.length;c<h;c++)i=r[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&s.push(i);this._events[e]=s}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,typeof t=="object"?this:n,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,typeof t=="object"?this:n,this),!t&&!n&&delete r[e._listenerId];else{typeof t=="object"&&(n=this);for(var i in r)r[i].off(t,n,this);this._listeners={}}return this}};c.bind=c.on,c.unbind=c.off,u.extend(o,c);var h=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(h.prototype,c,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o,a=this.attributes;return e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t,r&&(!n||!n.wait)&&!this.set(r,n)?!1:(n=u.extend({validate:!0},n),this._validate(r,n)?(r&&n.wait&&(this.attributes=u.extend({},a,r)),n.parse===void 0&&(n.parse=!0),i=n.success,n.success=function(e,t,n){e.attributes=a;var s=e.parse(t,n);n.wait&&(s=u.extend(r||{},s));if(u.isObject(s)&&!e.set(s,n))return!1;i&&i(e,t,n)},s=this.isNew()?"create":n.patch?"patch":"update",s==="patch"&&(n.attrs=r),o=this.sync(s,this,n),r&&n.wait&&(this.attributes=a),o):!1)},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(e,t,i){(i.wait||e.isNew())&&r(),n&&n(e,t,i)};if(this.isNew())return e.success(this,null,e),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||M();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,t||{}),!1):!0}});var p=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(p.prototype,c,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,i,o,a,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&h==null&&t.sort!=0,d=u.isString(this.comparator)?this.comparator:null;for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(a=e[n],t))){this.trigger("invalid",this,a,t);continue}if(f=this.get(o)){t.merge&&(f.set(a===o?o.attributes:a,t),p&&!l&&f.hasChanged(d)&&(l=!0));continue}c.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o)}c.length&&(p&&(l=!0),this.length+=c.length,h!=null?s.apply(this.models,[h,0].concat(c)):r.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=c.length;n<i;n++)(o=c[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e])},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){t=u.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var n,r,i,s,o=[],a=[],f={};u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);for(r=0,i=e.length;r<i;r++)n=e[r],s=this.get(n),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove)for(r=0,i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||a.push(n);return a.length&&this.remove(a,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){var i=r.update?"update":"reset";e[i](n,r),t&&t(e,n,r)},this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)}});var d=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var v=["groupBy","countBy","sortBy"];u.each(v,function(e){p.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var m=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,b=/\*\w+/g,w=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(m.prototype,c,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i),this.trigger.apply(this,["route:"+t].concat(i)),this.trigger("route",t,i),o.history.trigger("route",this,t,i)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(w,"\\$&").replace(g,"(?:$1)?").replace(y,function(e,t){return t?e:"([^/]+)"}).replace(b,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var E=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},S=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,T=/msie [\w.]+/,N=/\/$/;E.started=!1,u.extend(E.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(N,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(S,"")},start:function(e){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=T.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(x,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(S,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!E.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new E;var C=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];u.extend(C.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(k),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,L)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}});var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=A[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||M()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e){a&&a(t,e,n),t.trigger("sync",t,e,n)};var f=n.error;n.error=function(e){f&&f(t,e,n),t.trigger("error",t,e,n)};var l=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,l,n),l},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var O=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};h.extend=p.extend=m.extend=C.extend=E.extend=O;var M=function(){throw new Error('A "url" property or function must be specified')}}).call(this);var n=window.Backbone.noConflict();return n.$=t,n}),define("app/modules/cache",["backbone"],function(e){var t=e.Model.extend({exists:function(){return window.localStorage.getItem(this.get("name"))!==null&&window.localStorage.getItem(this.get("name")+"_last_update")!==null?!0:!1},is_recent:function(){if(this.exists()===!1)return!1;var e=window.localStorage.getItem(this.get("name")+"_last_update"),t=((new Date).getTime()-e)/1e3;return t<600?!0:!1},save:function(e){window.localStorage.setItem(this.get("name"),JSON.stringify(e)),window.localStorage.setItem(this.get("name")+"_last_update",(new Date).getTime())},fetch:function(){var e=window.localStorage.getItem(this.get("name"));try{return JSON.parse(e)}catch(t){return!1}},wipe:function(){delete window.localStorage[this.get("name")],delete window.localStorage[this.get("name")+"_last_update"]}});return t}),define("app/core/global",["underscore","backbone","../modules/cache"],function(e,t,n){var r=new n({name:"social_reader_cache"}),i=t.Model.extend({defaults:{auto_sharing:!0,user:{},activity:[],friends:[]},initialize:function(){this.setup_cache(),this.set_preset_values(),this.cache_on_change()},setup_cache:function(){this.set("is_cached",r.exists()),this.set("is_cached_recently",r.is_recent()),this.get("is_cached")&&(this.attributes=e.extend(this.attributes,r.fetch()))},cache_on_change:function(){var t=this;this.on("change",function(){r.save(e.omit(t.attributes,["is_cached","is_cached_recently"]))})},set_preset_values:function(){var t=this,n=e.clone(window._sr);e.each(n,function(e,n){t.set(n,e)})}});return window._sr=new i,window._sr}),define("app/modules/facebook/fb",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({start:function(t){var n=this;if(!this.get("app_id"))return!1;this.get("sdk_disabled")===!0?(this.sdk_check_count=0,this.wait_for_fb(function(){t()})):(e("#fb-root").length===0&&e("body").prepend('<div id="fb-root"></div>'),window.fbAsyncInit=function(){FB.init({appId:n.get("app_id"),channelUrl:n.get("channel_url"),status:!0,cookie:!0,xfbml:!0}),t()},function(e,t){var n,r,i;r=void 0,n="facebook-jssdk",i=e.getElementsByTagName("script")[0];if(e.getElementById(n))return;return r=e.createElement("script"),r.id=n,r.async=!0,r.src="//connect.facebook.net/en_US/all"+(t?"/debug":"")+".js",i.parentNode.insertBefore(r,i)}(window.document,!1))},wait_for_fb:function(t){this.sdk_check_count++;if(this.sdk_check_count>10)return;var n=this;window.FB?e("#fb-root").length===1?t():setTimeout(function(){n.wait_for_fb()},100):setTimeout(function(){n.wait_for_fb()},100)},is_logged_in:function(e){FB.getLoginStatus(function(t){e(t.status==="connected"?!0:!1)})},get_data:function(e){var t=this;t.get_user(function(){t.get_friends(function(){t.get_activity(function(){e(t.get("user"),t.get("friends"),t.get("activity"))})})})},get_user:function(e){var t=this;FB.api("/me",function(n){n.picture="//graph.facebook.com/"+n.id+"/picture",t.set("user",n),e()})},get_friends:function(e){var t=this;FB.api("/me/friends?fields=id,name,installed",function(n){t.set("friends",n.data),e()})},get_friends_appusers:function(){var e=[];return t.each(this.get("friends"),function(t){t.installed===!0&&e.push(t)}),e},get_activity:function(e){var n=this,r=[];r.push({method:"GET",user_id:this.get("user").id,relative_url:"me/"+this.get("action_type")+"?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from"}),t.each(this.get_friends_appusers(),function(e){r.push({method:"GET",user_id:e.id,relative_url:e.id+"/"+n.get("action_type")+"?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from"})}),FB.api("/","POST",{batch:r},function(r){var i=[];t.each(r,function(e,t){if(!e||!e.body)return;var n=JSON.parse(e.body);i.push(n)}),n.set("activity",i),e()})},login:function(e){var t=this;FB.login(function(t){t.status==="connected"&&e()},{scope:"publish_actions"})},logout:function(e){FB.logout(function(t){e()})},add_read:function(e){var t=this;FB.api("/me/"+this.get("action_type")+"?article="+window.location.href,"post",function(n){e!==undefined&&(n.id?t.get_read(n.id,function(t){e(n)}):e(!1))})},get_read:function(e,t){FB.api("/"+e,"GET",function(e){e.error?t(!1):t(e)})},refresh_my_activity:function(){FB.api("me/"+this.get("action_type")+"?fields=id,comment_info,comments,comment_info,likes,like_info,data,publish_time,from",function(e){window._sr.activity[0]=e})},delete_read:function(e,t){FB.api("/"+e,"delete",function(e){t(e)})}}),i=new r;return i}),define("app/core/helpers/sort",[],function(){var e=function(e,t,n){return n===undefined?e=e.sort():e=e.sort(function(e,t){var r=e[n],i=t[n];return r<i?-1:r>i?1:0}),(t||"asc")=="desc"&&(e=e.reverse()),e};return e}),define("app/core/user",["backbone","underscore","./global","../modules/facebook/fb","./helpers/sort"],function(e,t,n,r,i){var s=e.Model.extend({initialize:function(){r.set(n.get("facebook"))},start:function(e){var t=this;r.start(function(){r.is_logged_in(function(t){t?n.get("is_cached_recently")===!1?r.get_data(function(t,r,i){n.set({user:t,friends:r,activity:i}),e(!0)}):e(!0):e(!1)})})},queue_read:function(){return n.get("auto_sharing")===!0&&n.get("site").page_readable=="true"?(setTimeout(function(){r.add_read(function(e){var t=n.get("activity");t[0].data.unshift(e),n.set("activity",t),n.trigger("change")})},2e3),!0):!1},put_all_reads_in_one_array:function(e){var n=[];return t.each(e,function(e){t.each(e.data,function(e){n.push(e)})}),i(n,"desc","publish_time")},login:function(){r.login(function(){window.location.reload()})},logout:function(e){r.logout(function(){e()})},delete_read:function(e,i){r.delete_read(e,function(r){if(r===!0){var s=n.get("activity");t.each(s[0].data,function(t,n){t.id==e&&s[0].data.splice(n)}),n.set("activity",s),n.trigger("change"),i(!0)}else i(!1)})}});return new s}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=[],i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},s=function(e,t){var n=i,r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.interpolate,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(n.evaluate||null,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"; __p.push('"}).replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,"")+"');}return __p.join('');";return r};define("tpl",[],function(){var i,o,u;return typeof window!="undefined"&&window.navigator&&window.document?o=function(e,t){var n=i.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node&&(u=require.nodeRequire("fs"),o=function(e,t){t(u.readFileSync(e,"utf8"))}),i={version:"0.24.0",strip:function(e){if(e){e=e.replace(t,"");var r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"").replace(/[\t]/g,"").replace(/[\r]/g,"")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("require.getXhr(): XMLHttpRequest not available");return t},get:o,load:function(e,t,n,o){var u=!1,a,f=e.indexOf("."),l=e.substring(0,f),c=e.substring(f+1,e.length);f=c.indexOf("!"),f!==-1&&(u=c.substring(f+1,c.length),u=u==="strip",c=c.substring(0,f)),a="nameToUrl"in t?t.nameToUrl(l,"."+c):t.toUrl(l+"."+c),i.get(a,function(t){t=s(t),o.isBuild||(t=new Function("obj",t)),t=u?i.strip(t):t,o.isBuild&&o.inlineText&&(r[e]=t),n(t)})},write:function(e,t,n){if(t in r){var s=i.jsEscape(r[t]);n("define('"+e+"!"+t+"', function() {return function(obj) { "+s.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"}});\n")}}}})}(),define("tpl!app/core/widgets/global.css",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("body {  font-family:arial;  font-size:12px;}a {  color: #3B5998;  cursor:pointer;}a:hover {  text-decoration:underline;}");return __p.join("")}}),define("app/core/widgets/widget",["jquery","underscore","backbone","../global","tpl!./global.css"],function(e,t,n,r,i){var s=n.View.extend({create_iframe:function(n){var r={border:0};n!==undefined&&(r=t.extend(r,n));var s=e("<iframe />",r);this.$container.prepend(s),this.setElement(s.contents()),this.load_css(i)},load_css:function(t){var n=e("<style />",{type:"text/css",html:t(r.site)});this.$el.find("head").append(n)}});return s}),define("app/core/widgets/lightbox/time",[],function(){var e=function(e){var t,n,r,i,s,o,u;return u=(new Date(e)).getTime(),i=6e4,r=i*60,n=r*24,s=n*30,o=n*365,t=(new Date).getTime()-u,t<i?Math.round(t/1e3)+" seconds ago":t<r?Math.round(t/i)+" minutes ago":t<n?Math.round(t/r)+" hours ago":t<s?Math.round(t/n)+" days ago":t<o?Math.round(t/s)+" months ago":Math.round(t/o)+" years ago"};return e}),define("tpl!app/core/widgets/lightbox/style.css",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("body {  margin:0;  padding:0;}.lightbox {  background: #fff;  background: url(https://s3-eu-west-1.amazonaws.com/social-api/images/borderbg.png) repeat;  -webkit-border-radius: 10px;  -moz-border-radius: 10px;  border-radius: 10px;  width:100%;  height:100%;  position:relative;}.inner {  background:#fff;  top:10px;  right:10px;  left:10px;  bottom:10px;  position:absolute;  overflow: hidden;}a {  text-decoration: none;}a:hover {  text-decoration: underline;}.close {  position:absolute;  font-weight:bold;  color:#fff;  font-size:14px;  top:7px;  right:11px;}h3 {  margin:0;  border-bottom:1px solid #ccc;  padding:4px 5px 4px 10px;  font-size:18px;  background:#6D84B4;  border:1px solid #3B5998;  font-weight:bold;  color:#fff;}.loading {  width:24px;  height:24px;  position:absolute;  left:50%;  top:100px;  margin-left:-12px;}.reads_empty {  padding:5px 10px;}.tabs {  list-style-type:none;  margin:0;  padding:8px 15px;  background:#f6f6f6;  border-bottom:1px solid #ccc;}.tabs li {  font-size:14px;  display:inline-block;  margin-right:15px;}.tabs li.active a {  font-weight:bold;  color:#333;  cursor:text;}.tabs li.active a:hover {  text-decoration:none;}.reads_list {  overflow-y:auto;  margin:0;  height:505px;}.reads_list ul {  list-style-type:none;  padding:10px 0 0 0;  margin:0;}.reads_list ul li {  border-bottom:1px solid #eee;  padding:5px 10px 10px 10px;  margin-bottom:10px;  font-size:14px;}.reads_list ul li .story-img {  width:50px;  height:50px;  float:left;  display:block;  margin:2px 0 0 0;}.reads_list ul li .story-inner {  margin:0 0 0 13px;  padding:0;  float:left;  width:470px;}.reads_list ul li .story-inner .story-title {  margin:0 0 10px 0;}.reads_list ul li .story-inner .story-title a {  font-weight:bold;}.reads_list ul li .story-inner .story-meta {  color:#777;  margin:0;  font-size:12px;}.reads_list ul li .story-inner .story-meta .story-time {  color:#777;}.reads_list ul .sr_friend_story .story-inner .story-meta .sr_story_delete_text {  display:none;}.reads_list ul li .story-inner .story-like-arrow {  display:block;  height:5px;  overflow:hidden;  background:url(../images/fbarrow.png) no-repeat 21px 0;  margin:3px 0 0 0;  padding:0;}.reads_list ul li .story-inner .story-likes {  background:#edeff4 url(../images/fblike.png) no-repeat 6px 5px;  font-size:12px;  padding:5px 5px 5px 27px;  margin:0 0 1px 0;}.reads_list ul li .story-inner .story-comments {  font-size:12px;  margin:0 0 5px 0;  padding:0;}.reads_list ul li .story-inner .story-comments ul.comment-list {  margin:0;  padding:0;}.reads_list ul li .story-inner .story-comments ul.comment-list li {  min-height:35px;  padding:5px;  background:#edeff4;  margin:0 0 1px 0;  font-size:12px;}.reads_list ul li .story-inner .story-comments ul.comment-list li img {  float:left;  margin-right:7px;}.reads_list ul li .story-inner .story-comments ul.comment-list li .comment-meta {  color:#777;  margin:4px 0 0 0;}.reads_list ul li .story-inner .story-comments .new-comment {  background:#edeff4;  padding:5px;  margin:0;}.reads_list ul li .story-inner .story-comments .new-comment img {  float:left;  margin-right:7px;}.reads_list ul li .story-inner .story-comments .new-comment input {  color:#777;  border:1px solid #BDC7D8;  margin:0;  padding:3px;  width:415px;}input.input-pending {  background:#eee;  color:#777 !important;}#noReadsMessage {  margin:10px;}.clear {  clear: both;}");return __p.join("")}}),define("tpl!app/core/widgets/lightbox/lightbox.html",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div class='lightbox'>  <div class='inner'>    <h3>",lightbox.title,"</h3>    <a class='close'>Close</a>    ",contents,"  </div></div>");return __p.join("")}}),define("tpl!app/core/widgets/lightbox/reads.html",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<ul class='tabs'>  <li class='everyone active'><a>Everyone</a></li>  <li class='me'><a>Just you</a></li></ul><div class='reads_list'>  <ul>    "),_.each(reads,function(e){__p.push("      <li data-id='",e.id,"' data-from=\"",e.from_type,"\">        <a class='name' href='//facebook.com/",e.from.id,"' target='blank'>          <img class='story-img' src='https://graph.facebook.com/",e.from.id,"/picture' width='50' height='50' alt='",e.from.name,"' />        </a>        <div class='story-inner'>          <div class='story-title'>            <a class='name' href='//facebook.com/profile.php?id=",e.from.id,"' target='blank'>",e.from.name,"</a>             read             <a class='article' href='",e.data.article.url,"' target='blank'>",e.data.article.title,"</a>          </div>          <div class='story-meta'>            ",e.relative_time,"             "),e.from_type=="me"&&__p.push("<span class='delete_text'>&middot; <a class='story_delete'>Delete</a></span>"),__p.push("          </div>        </div>        <div class='clear'></div>      </li>    ")}),__p.push("  </ul>  "),reads.length===0&&__p.push("    <div class='reads_empty'>      None of your friends have read anything on this site yet.    </div>  "),__p.push("</div>");return __p.join("")}}),define("app/core/widgets/lightbox/lightbox",["jquery","underscore","../../user","../../global","../widget","./time","tpl!./style.css","tpl!./lightbox.html","tpl!./reads.html"],function(e,t,n,r,i,s,o,u,a){var f=i.extend({initialize:function(){this.$container=e("body");if(this.$container.length===0)return;this.create_iframe({id:"sr_lightbox",css:this.get_iframe_styles()}),this.load_css(o),this.render()},get_iframe_styles:function(){return{height:"580px",width:"580px",display:"none",position:"fixed",margin:"0 0 0 -290px",padding:"10px",top:"75px",left:"50%",right:"0px",bottom:"0px","z-index":"99999"}},show:function(e,t){var n=this;this.$container.find("#sr_lightbox").fadeIn("fast",function(){n.show_activity(e,t)})},events:{"click .close":"close","click .tabs li a":"switch_tab","click .story_delete":"delete_read"},close:function(){var t=this;if(this.closing===!0)return;this.closing=!0,e("#sr_lightbox").fadeOut(function(){t.$el.find(".inner").html(""),delete t.closing})},show_activity:function(){var e=n.put_all_reads_in_one_array(r.get("activity"));t.each(e,function(t,n){e[n].relative_time=s(e[n].publish_time),t.from.id==r.get("user").id?e[n].from_type="me":e[n].from_type="friend"});var i=a(t.extend(r.attributes,{reads:e})),o=u(t.extend(r.attributes,{contents:i}));this.$el.find("body").html(o)},switch_tab:function(t){this.$el.find(".tabs li").removeClass("active");var n=e(t.currentTarget).closest("li").addClass("active");n.hasClass("me")?this.$el.find("[data-from='friend']").hide():this.$el.find("[data-from='friend']").show()},delete_read:function(t){e(t.currentTarget).text("Deleting...");var r=e(t.currentTarget).closest("li"),i=r.attr("data-id");n.delete_read(i,function(e){e&&r.fadeOut(function(){r.remove()})})}});return f}),define("tpl!app/core/widgets/sidebar/logged_in.html",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div class='logged_in'>  <a class='profile' target='blank' href='",user.link,"'><img src='",user.picture,"' width='50' height='50' alt='",user.name,"'/></a>  <div class='right'>    <div class='name'>      <a target='blank' href=\"",user.link,'" >',user.name,"</a>    </div>    <div class='promo'>",sidebar.login_meta,"</div>    <div class='logout'><a>",sidebar.logout,"</a></div>  </div>  <div class='clear'>  </div>  <div class='bottom'>    "),auto_sharing?__p.push("      <div class='toggle toggled_on'>        <a>",sidebar.auto_sharing_on,"</a>      </div>    "):__p.push("      <div class='toggle toggled_off'>        <a>",sidebar.auto_sharing_off,"</a>      </div>    "),__p.push("    <div class='activity'>      <a>",sidebar.activity,"</a>    </div>  </div></div>");return __p.join("")}}),define("tpl!app/core/widgets/sidebar/logged_out.html",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("<div class='logged_out'>  <p>",sidebar.login_promo,"</p>  <a class='login'><img src='",site.plugin_url,"/images/facebooklogin.jpg' width='180' height='40'/></a></div>");return __p.join("")}}),define("tpl!app/core/widgets/sidebar/style.css",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("/*   === Sidebar (not logged in) === */.logged_out {  text-align:center;  margin-top:10px;  color:#333;  font-weight:bold;  margin-bottom:15px;  font-size:14px;}.logged_out .login a {  }/*   === Sidebar (logged in) === */.logged_in {  margin-bottom:5px;  clear:both;}.logged_in img {  float:left;  margin-right:10px;  border:none;}.right {  margin-left:62px;}.logged_in .name {  font-weight:bold;  margin-bottom:4px;  font-size:14px;}.logged_in a {  font-weight:bold;  cursor:pointer;  color:#3B5998;  text-decoration:none;}.logged_in .toggle a {  margin-right:10px;}.logged_in .promo {  color:#777;  font-size:12px;  margin:2px 0 0 0;}.logged_in .logout {  margin-top:4px;}.logged_in .logout a {  font-weight:normal;}.logged_in .bottom {  margin:10px 0 0 0;}.logged_in .toggle {  display:inline-block;  padding-left:23px;  height:20px;} .logged_in .toggled_on {  background:url(https://s3-eu-west-1.amazonaws.com/social-api/images/fbpublishing.png) no-repeat;}.logged_in .toggled_off {  background:url(https://s3-eu-west-1.amazonaws.com/social-api/images/fbnotpublishing.png) no-repeat;}.logged_in .toggle a {  padding:0px;}.logged_in .activity {  display:inline-block;}.logged_in .activity a {  display:inline;}");return __p.join("")}}),define("app/core/widgets/sidebar/sidebar",["jquery","underscore","../widget","../../user","../lightbox/lightbox","../../global","tpl!./logged_in.html","tpl!./logged_out.html","tpl!./style.css"],function(e,t,n,r,i,s,o,u,a){var f=n.extend({initialize:function(){this.$container=e("#sr_sidebar_box");if(this.$container.length===0)return;this.create_iframe({id:"sr_sidebar"}),this.load_css(a),this.render(),this.lightbox=new i},render:function(){var e;if(!t.isEmpty(s.get("user"))){var n=s.get("auto_sharing")===!0?"auto_sharing_on":"auto_sharing_off";e=o(s.attributes),this.$el.find("body").html(e)}else{debugger;e=u(s.attributes),this.$el.find("body").html(e)}},events:{"click .toggle":"toggle_auto_sharing","click .activity":"show_lightbox","click .logout":"logout","click .login":"login"},login:function(t){$button=e(t.currentTarget),$button.css("opacity",.7),r.login()},toggle_auto_sharing:function(t){var n=e(t.currentTarget),r=n.hasClass("toggled_on")?!1:n.hasClass("toggled_off")?!0:!1,i=r===!0?s.get("sidebar").auto_sharing_on:s.get("sidebar").auto_sharing_off;n.toggleClass("toggled_on toggled_off"),n.find("a").text(i),s.set("auto_sharing",r)},show_lightbox:function(){this.lightbox.show()},logout:function(){r.logout(function(){window.location.reload()})}});return f}),define("app/core/widgets/single/format",["underscore"],function(e){var t={};return t.names_list=function(e,t){var n=this;this.user=e,t=this.check(t,e),this.reads=t,count=this.reads.length;var r="";return r+='<div class="sr_read_names">',count===0?r+="None of your friends have read this yet":count===1?r+=this.name(t[0],e)+" read this":count===2?r+=this.name(t[0],e)+" and "+this.name(t[1],e)+" read this":count===3?(r+=this.name(t[0],e)+", ",r+=this.name(t[1],e)+" and ",r+=this.name(t[2],e)+" read this"):(r+=this.name(t[0],e)+", ",r+=this.name(t[1],e)+" and ",r+=count-2+" others read this"),r+="</div>",r},t.name=function(e,t){return!e.from||!e.from.id||!e.from.name||!t.id?"":e.from.id===t.id?"You":'<a target="blank" href="//facebook.com/'+e.from.id+'">'+e.from.name+"</a>"},t.thumbs_list=function(t,n){n=this.check(n,t);var r="";return r+='<div class="sr_read_thumbs">',e.each(n,function(e){r+='<a target="blank" href="//facebook.com/'+e.from.id+'" title="'+e.from.name+'">',r+="<img src='//graph.facebook.com/"+e.from.id+"/picture' width='35' height='35' alt='"+e.from.name+"' />",r+="</a>"}),r+="</div>",r},t.check=function(t,n){var r=[];return t=e.filter(t,function(t){if(e.indexOf(r,t.from.id)===-1)return r.push(t.from.id),!0}),t=e.sortBy(t,function(e){return e.from.id==n.id?1:2}),t},t}),define("app/core/widgets/single/single",["jquery","underscore","../widget","./format"],function(e,t,n,r){var i=n.extend({initialize:function(){var n=window._sr.user,i=window._sr.activity;if(!n)return;if(e("#sr_friends_single").length!==0){if(!i)return;var s=Fb.put_all_reads_in_one_array(),o=t.filter(s,function(e){var t=new RegExp(window.location.pathname,"gi");if(!e.data||!e.data.article||!e.data.article.url)return!1;if(t.test(e.data.article.url))return!0}),u=r.names_list(n,o),a=r.thumbs_list(n,o),f=u+a}}});return i}),define("app/core/widgets/init",["underscore","./sidebar/sidebar","./single/single"],function(e,t,n){var r={sidebar:t,single:n},i=function(t){e.each(t,function(t){r[t]&&e.isFunction(r[t])&&new r[t]})};return i}),define("app/main",["jquery","./core/user","./core/widgets/init"],function(e,t,n){e(document).ready(function(){t.start(function(e){e?(n(["sidebar","lightbox","single"]),t.queue_read()):n(["sidebar"])})})});var appUrl=require.toUrl("app"),arr=appUrl.split("/");arr.pop();var dir=arr.join("/");require.config({baseUrl:dir+"/lib",paths:{app:dir+"/app"}}),requirejs(["app/main"]),define("app",function(){});